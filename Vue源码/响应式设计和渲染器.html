<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.67" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://jsweeta.github.io/blogs/blogs/Vue%E6%BA%90%E7%A0%81/%E5%93%8D%E5%BA%94%E5%BC%8F%E8%AE%BE%E8%AE%A1%E5%92%8C%E6%B8%B2%E6%9F%93%E5%99%A8.html"><meta property="og:title" content="å“åº”å¼è®¾è®¡å’Œæ¸²æŸ“å™¨è®¾è®¡"><meta property="og:description" content="é’ˆå¯¹Vue3æºç é‡Œå“åº”å¼çš„è®¾è®¡æ–¹æ³•å’Œæ¸²æŸ“å™¨çš„è®¾è®¡ã€‚"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-10-25T07:20:45.000Z"><meta property="article:author" content="Jsweet"><meta property="article:tag" content="Vue"><meta property="article:tag" content="VNode"><meta property="article:tag" content="AST"><meta property="article:modified_time" content="2023-10-25T07:20:45.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"å“åº”å¼è®¾è®¡å’Œæ¸²æŸ“å™¨è®¾è®¡","image":[""],"dateModified":"2023-10-25T07:20:45.000Z","author":[{"@type":"Person","name":"Jsweet","url":"https://github.com/JsweetA"}]}</script><link rel="icon" href="/blogs/./favicon.ico"><title>å“åº”å¼è®¾è®¡å’Œæ¸²æŸ“å™¨è®¾è®¡</title><meta name="description" content="é’ˆå¯¹Vue3æºç é‡Œå“åº”å¼çš„è®¾è®¡æ–¹æ³•å’Œæ¸²æŸ“å™¨çš„è®¾è®¡ã€‚">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/blogs/assets/style-bff87b00.css" as="style"><link rel="stylesheet" href="/blogs/assets/style-bff87b00.css">
    <link rel="modulepreload" href="/blogs/assets/app-e319b9e5.js"><link rel="modulepreload" href="/blogs/assets/å“åº”å¼è®¾è®¡å’Œæ¸²æŸ“å™¨.html-a04d59c0.js"><link rel="modulepreload" href="/blogs/assets/plugin-vue_export-helper-c27b6911.js"><link rel="modulepreload" href="/blogs/assets/å“åº”å¼è®¾è®¡å’Œæ¸²æŸ“å™¨.html-5460969a.js"><link rel="prefetch" href="/blogs/assets/intro.html-8b519e82.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-b529c129.js" as="script"><link rel="prefetch" href="/blogs/assets/æœ€é•¿é€’å¢å­åºåˆ—.html-c8992280.js" as="script"><link rel="prefetch" href="/blogs/assets/å†…å»ºç»„ä»¶å’Œæ¨¡å—.html-cd66ca5b.js" as="script"><link rel="prefetch" href="/blogs/assets/æœåŠ¡ç«¯æ¸²æŸ“.html-77adebb4.js" as="script"><link rel="prefetch" href="/blogs/assets/æ¨¡æ¿ç¼–è¯‘å™¨.html-e7848ca8.js" as="script"><link rel="prefetch" href="/blogs/assets/ç»„ä»¶å®ç°åŸç†.html-e5798467.js" as="script"><link rel="prefetch" href="/blogs/assets/00_å¸¸ç”¨é…ç½®.html-8c673630.js" as="script"><link rel="prefetch" href="/blogs/assets/404.html-d8f42e22.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-dd7793da.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-83062248.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-8adfd74d.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-a472d696.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-4c5d2e6d.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-c05d882f.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-a12353aa.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-bebec215.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-536d9b6e.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-c1f8010a.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-720f245f.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-419ca6a7.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-3782a7c9.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-0927a5a0.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-8b7975d0.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-d99a087d.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-593bbd48.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-c1bac3e3.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-c56217c9.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-c5cc70a1.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-138628ba.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-abc6a14a.js" as="script"><link rel="prefetch" href="/blogs/assets/intro.html-445200b4.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-94169644.js" as="script"><link rel="prefetch" href="/blogs/assets/æœ€é•¿é€’å¢å­åºåˆ—.html-0f348105.js" as="script"><link rel="prefetch" href="/blogs/assets/å†…å»ºç»„ä»¶å’Œæ¨¡å—.html-1e72ab3b.js" as="script"><link rel="prefetch" href="/blogs/assets/æœåŠ¡ç«¯æ¸²æŸ“.html-a19a8850.js" as="script"><link rel="prefetch" href="/blogs/assets/æ¨¡æ¿ç¼–è¯‘å™¨.html-c804a838.js" as="script"><link rel="prefetch" href="/blogs/assets/ç»„ä»¶å®ç°åŸç†.html-73118b4d.js" as="script"><link rel="prefetch" href="/blogs/assets/00_å¸¸ç”¨é…ç½®.html-f95eb06f.js" as="script"><link rel="prefetch" href="/blogs/assets/404.html-0b51b84c.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-b2827d63.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-6247fb77.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-158797a2.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-e7745251.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-2edc4972.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-8503acc6.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-784bb3ae.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-7692919e.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-893000a1.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-5d81c84d.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-3e9ec937.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-bb7bbad3.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-cf5be202.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-8fe00132.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-2adca0b4.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-62ebeb2e.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-b064122f.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-b7ebb9eb.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-5b6166f5.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-6d98eb96.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-341db445.js" as="script"><link rel="prefetch" href="/blogs/assets/index.html-52ce1a17.js" as="script"><link rel="prefetch" href="/blogs/assets/giscus-0b7adcf8.js" as="script"><link rel="prefetch" href="/blogs/assets/auto-fe80bb03.js" as="script"><link rel="prefetch" href="/blogs/assets/index-2bf332f6.js" as="script"><link rel="prefetch" href="/blogs/assets/flowchart-c441f34d.js" as="script"><link rel="prefetch" href="/blogs/assets/mermaid.core-c0b8a874.js" as="script"><link rel="prefetch" href="/blogs/assets/reveal.esm-1a4c3ae7.js" as="script"><link rel="prefetch" href="/blogs/assets/markdown.esm-9d5bc2ce.js" as="script"><link rel="prefetch" href="/blogs/assets/highlight.esm-75b11b9d.js" as="script"><link rel="prefetch" href="/blogs/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/blogs/assets/search.esm-7e6792e2.js" as="script"><link rel="prefetch" href="/blogs/assets/notes.esm-a106bb2c.js" as="script"><link rel="prefetch" href="/blogs/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/blogs/assets/VuePlayground-14c733de.js" as="script"><link rel="prefetch" href="/blogs/assets/photoswipe.esm-1464cdb9.js" as="script"><link rel="prefetch" href="/blogs/assets/pageview-ea086c58.js" as="script"><link rel="prefetch" href="/blogs/assets/SearchResult-83270d23.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand vp-brand" href="/blogs/"><img class="vp-nav-logo" src="/blogs/logo.jpg" alt><!----><!----></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a aria-label="posts" class="vp-link nav-link nav-link" href="/blogs/posts/"><!---->posts<!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="Algorithm" class="vp-link nav-link nav-link" href="/blogs/Algorithm/"><!---->Algorithm<!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="Vueæºç " class="vp-link nav-link active nav-link active" href="/blogs/Vue%E6%BA%90%E7%A0%81/"><!---->Vueæºç <!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="æ‚é¡¹" class="vp-link nav-link nav-link" href="/blogs/%E6%9D%82%E9%A1%B9/"><!---->æ‚é¡¹<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/JsweetA/blogs" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="search-pro-button" role="search" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">æœç´¢</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><!--[--><a aria-label="å†…å»ºç»„ä»¶å’Œæ¨¡å—" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blogs/Vue%E6%BA%90%E7%A0%81/%E5%86%85%E5%BB%BA%E7%BB%84%E4%BB%B6%E5%92%8C%E6%A8%A1%E5%9D%97.html"><!---->å†…å»ºç»„ä»¶å’Œæ¨¡å—<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="å“åº”å¼è®¾è®¡å’Œæ¸²æŸ“å™¨è®¾è®¡" class="vp-link nav-link active vp-sidebar-link vp-sidebar-page active nav-link active vp-sidebar-link vp-sidebar-page active" href="/blogs/Vue%E6%BA%90%E7%A0%81/%E5%93%8D%E5%BA%94%E5%BC%8F%E8%AE%BE%E8%AE%A1%E5%92%8C%E6%B8%B2%E6%9F%93%E5%99%A8.html"><!---->å“åº”å¼è®¾è®¡å’Œæ¸²æŸ“å™¨è®¾è®¡<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="å“åº”å¼è®¾è®¡" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/blogs/Vue%E6%BA%90%E7%A0%81/%E5%93%8D%E5%BA%94%E5%BC%8F%E8%AE%BE%E8%AE%A1%E5%92%8C%E6%B8%B2%E6%9F%93%E5%99%A8.html#å“åº”å¼è®¾è®¡"><!---->å“åº”å¼è®¾è®¡<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="æ¸²æŸ“å™¨è®¾è®¡" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/blogs/Vue%E6%BA%90%E7%A0%81/%E5%93%8D%E5%BA%94%E5%BC%8F%E8%AE%BE%E8%AE%A1%E5%92%8C%E6%B8%B2%E6%9F%93%E5%99%A8.html#æ¸²æŸ“å™¨è®¾è®¡"><!---->æ¸²æŸ“å™¨è®¾è®¡<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a aria-label="æœåŠ¡ç«¯æ¸²æŸ“" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blogs/Vue%E6%BA%90%E7%A0%81/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93.html"><!---->æœåŠ¡ç«¯æ¸²æŸ“<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="æ¨¡æ¿ç¼–è¯‘å™¨" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blogs/Vue%E6%BA%90%E7%A0%81/%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91%E5%99%A8.html"><!---->æ¨¡æ¿ç¼–è¯‘å™¨<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="ç»„ä»¶å®ç°åŸç†" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/blogs/Vue%E6%BA%90%E7%A0%81/%E7%BB%84%E4%BB%B6%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86.html"><!---->ç»„ä»¶å®ç°åŸç†<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->å“åº”å¼è®¾è®¡å’Œæ¸²æŸ“å™¨è®¾è®¡</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/JsweetA" target="_blank" rel="noopener noreferrer">Jsweet</a></span><span property="author" content="Jsweet"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-10-25T07:20:45.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 32 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT32M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category6 clickable" role="navigation">æºç </span><!--]--><meta property="articleSection" content="æºç "></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item tag2 clickable" role="navigation">Vue</span><span class="page-tag-item tag2 clickable" role="navigation">VNode</span><span class="page-tag-item tag1 clickable" role="navigation">AST</span><!--]--><meta property="keywords" content="Vue,VNode,AST"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/blogs/#å“åº”å¼è®¾è®¡">å“åº”å¼è®¾è®¡</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/blogs/#æ¸²æŸ“å™¨è®¾è®¡">æ¸²æŸ“å™¨è®¾è®¡</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h2 id="å“åº”å¼è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#å“åº”å¼è®¾è®¡" aria-hidden="true">#</a> å“åº”å¼è®¾è®¡</h2><p><a href="https://github.com/JsweetA/vue-sourceCode-study/tree/reactive/reactiveBasis" target="_blank" rel="noopener noreferrer">https://github.com/JsweetA/vue-sourceCode-study/tree/reactive/reactiveBasis<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><blockquote><p>è¯¦ç»†è¯·çœ‹ä»“åº“æºç æ³¨é‡Š</p></blockquote><h2 id="æ¸²æŸ“å™¨è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#æ¸²æŸ“å™¨è®¾è®¡" aria-hidden="true">#</a> æ¸²æŸ“å™¨è®¾è®¡</h2><p>æ¸²æŸ“å™¨å’Œå“åº”å¼ç»“åˆï¼šå°±å¯ä»¥è¾¾åˆ°é‚£ç§æ•°æ®è·Ÿé¡µé¢åŒæ­¥çš„æ•ˆæœ</p><hr><p><a name="NfSj6"></a></p><h5 id="vueè®¾è®¡ä¸å®ç°ç¬¬ä¸ƒç« -æ¸²æŸ“å™¨çš„è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#vueè®¾è®¡ä¸å®ç°ç¬¬ä¸ƒç« -æ¸²æŸ“å™¨çš„è®¾è®¡" aria-hidden="true">#</a> vueè®¾è®¡ä¸å®ç°ç¬¬ä¸ƒç« ï¼šæ¸²æŸ“å™¨çš„è®¾è®¡</h5><p>æ¸²æŸ“å‡½æ•°ï¼š<code>renderer(vnode,container)</code></p><ul><li>vnode:è™šæ‹ŸèŠ‚ç‚¹</li><li>containerï¼šå®¹å™¨</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">renderer</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h1&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/h1&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;app&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
count<span class="token punctuation">.</span>value<span class="token operator">++</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>å¦‚æœè¯¥èŠ‚ç‚¹ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œå±äºç¬¬ä¸€æ¬¡ï¼Œåˆ™å®ƒå«åšæŒ‚åœ¨ï¼ˆmountï¼‰,åä¹‹åˆ™æ˜¯oldVnodeå’ŒnewVnodeé€šè¿‡patchæ–¹æ³•æ¯”è¾ƒæ‰“è¡¥ä¸è¿›è¡Œæ¸²æŸ“ï¼ˆä¹Ÿå°±æ˜¯diffï¼‰</p></blockquote><p>è€Œæ¸²æŸ“å™¨åˆ™æ˜¯ç”±<code>createRenderer</code>æ‰€åˆ›å»ºï¼Œä»¥ä¸‹æ˜¯è°ƒç”¨è¯¥å‡½æ•°çš„è¿”å›å€¼ï¼š</p><ul><li><code>render</code>ï¼šæ¸²æŸ“å™¨</li><li><code>hydrate</code>ï¼šæœåŠ¡å™¨çš„æ¸²æŸ“å™¨</li><li>ï¼ˆè¿˜æœ‰ä¸€ä¸ªï¼Œå¿˜è®°äº†ï¼‰</li></ul><blockquote><p>å…¶å®ä¸ç®¡æ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“è¿˜æ˜¯ç¬¬äºŒæ¬¡æ¸²æŸ“ï¼Œå…¶å®éƒ½å¯ä»¥å«åšæ‰“è¡¥ä¸ï¼Œä¸€èˆ¬æ¥è®²ç¬¬ä¸€æ¬¡å«åšæŒ‚è½½ï¼Œå…¶ä»–å«åšæ‰“è¡¥ä¸ï¼Œæ¯•ç«Ÿæ¸²æŸ“å™¨çš„ä¸»è¦å·¥ä½œå°±æ˜¯æŒ‚è½½ã€æ›´æ–°å’Œæ¸²æŸ“ã€‚</p></blockquote><p><em>renderï¼š</em></p><ol><li><em>if vnode is exist</em><ol><li><em>patch(oldVnode,vnode,container)</em></li></ol></li><li>_else _ <ol><li><em>if oldVnode is exist</em></li><li><em>oldVnode = null</em></li></ol></li><li><em>oldVnode = vnode</em></li></ol><blockquote><p>å…¶ä¸­ç¬¬äºŒæ­¥æ˜¯æŒ‡æ–°çš„ä¸å­˜åœ¨ï¼Œè€Œæ—§çš„å­˜åœ¨çš„è¯ï¼Œåº”è¯¥æ‰§è¡Œunmountæ“ä½œã€‚</p></blockquote><p>vnodeæ˜¯ä¸€ä¸ªobjectï¼Œå…¶ä¸­æœ‰<code>type</code>ï¼Œ<code>children</code>ï¼Œ<code>props</code>ç­‰å±æ€§ï¼Œè€Œ<code>render</code>å¯ä»¥å°†è¿™ç§<code>vnode</code>è½¬æ¢æˆçœŸå®domï¼Œç®€å•çš„è¿™ç§æ“ä½œå°±å¯ä»¥é€šè¿‡å°è£…ä¸€ä¸ªæ–¹æ³•å»è°ƒç”¨apiè¿›è¡Œåˆ›å»ºå’ŒæŒ‚è½½ã€‚<br>ä¸è¿‡è€ƒè™‘åˆ°è€¦åˆæ€§ï¼Œä¸ºäº†ä½¿è¿™ç§æ¨¡æ¿å¯ä»¥åœ¨ä¸åŒç¯å¢ƒä¸‹è¿è¡Œï¼Œæ‰€ä»¥è¿™ç§è°ƒç”¨apiçš„ä¸œè¥¿ï¼ŒæŒ‚åœ¨çš„ä¸œè¥¿éƒ½æ˜¯å¤–éƒ¨ä¼ è¿›è¿™ä¸ª<code>createRenderer</code>å‡½æ•°é‡Œçš„ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>vnode <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&#39;h1&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">children</span><span class="token operator">:</span><span class="token string">&#39;æˆ‘æ˜¯ä¸€ä¸ªvnodeObj&#39;</span>
  <span class="token comment">// children:[</span>
  <span class="token comment">//   {...},</span>
  <span class="token comment">//]</span>
  <span class="token comment">// å¯¹è±¡æ•°ç»„ï¼Œé‡Œé¢å­˜æ”¾çš„æ˜¯vnode</span>
<span class="token punctuation">}</span>
<span class="token comment">// è½¬æ¢ååº”è¯¥æ˜¯&lt;h1&gt;æˆ‘æ˜¯ä¸€ä¸ªvnodeObj&lt;/h1&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»ä¹‹ï¼Œæ¸²æŸ“å™¨çš„ä½œç”¨å°±æ˜¯å°†vnodeæ¸²æŸ“æˆçœŸå®domï¼Œé€šè¿‡ä¸æ–­åœ°patch</p><hr><p><a name="dxqXL"></a></p><h5 id="vueè®¾è®¡ä¸å®ç°ç¬¬å…«ç« -æŒ‚è½½ä¸æ›´æ–°" tabindex="-1"><a class="header-anchor" href="#vueè®¾è®¡ä¸å®ç°ç¬¬å…«ç« -æŒ‚è½½ä¸æ›´æ–°" aria-hidden="true">#</a> vueè®¾è®¡ä¸å®ç°ç¬¬å…«ç« ï¼šæŒ‚è½½ä¸æ›´æ–°</h5><p><a name="INv7B"></a></p><h6 id="_8-1-8-3-æŒ‚åœ¨å­èŠ‚ç‚¹å’Œå…ƒç´ å±æ€§å’Œæ­£ç¡®çš„è®¾ç½®å…ƒç´ å±æ€§" tabindex="-1"><a class="header-anchor" href="#_8-1-8-3-æŒ‚åœ¨å­èŠ‚ç‚¹å’Œå…ƒç´ å±æ€§å’Œæ­£ç¡®çš„è®¾ç½®å…ƒç´ å±æ€§" aria-hidden="true">#</a> 8.1-8.3ï¼šæŒ‚åœ¨å­èŠ‚ç‚¹å’Œå…ƒç´ å±æ€§å’Œæ­£ç¡®çš„è®¾ç½®å…ƒç´ å±æ€§</h6><p><code>mountElement</code>å‡½æ•°</p><ul><li>vnode</li><li>container</li></ul><p>å®ƒä¼šå»åˆ¤æ–­<code>vnode.children</code>å±æ€§æ˜¯å¦æ˜¯<code>string</code>,æ˜¯çš„è¯å°±ç›´æ¥æŒ‚åœ¨æ–‡æœ¬å†…å®¹ï¼Œåä¹‹å¦‚æœæ˜¯æ•°ç»„ï¼Œåˆ™è¿›è¡Œå°†æ•°ç»„å†…çš„å†…å®¹å…¨éƒ¨æŒ‚åœ¨åˆ°<code>vnode.type</code>ä¸Šï¼Œç„¶åæœ€åæ’å…¥åˆ°<code>container</code>ã€‚<br>æ·»åŠ <code>el</code>çš„å±æ€§æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li><code>HTML Attributes</code></li><li><code>DOM Properties</code></li></ul><p>é—®é¢˜ï¼š<code>attributes</code>ä¸<code>DOM Properties</code>ä¸æ˜¯ç›´æ¥æ˜ å°„,å­˜åœ¨ä¸€ä¸ª<code>HTML Attributes</code> ä¼šå…³è”å¤šä¸ª<code>DOM Properties</code>çš„æƒ…å†µã€‚</p><blockquote><p>æ¥è‡ªä¹¦é‡Œæ‰€è®²ï¼šâ€œåªéœ€è¦è®°ä½ä¸€ä¸ªåŸåˆ™ï¼š<code>HTML Attributes</code> æ˜¯ è®¾ç½®ä¸ä¹‹å¯¹åº”çš„<code>DOM Properties</code>çš„åˆå§‹å€¼â€</p></blockquote><p>æ‰€ä»¥è¦æ­£ç¡®çš„è®¾ç½®å…ƒç´ å±æ€§ï¼Œéœ€è¦çœ‹æƒ…å†µæ¥è¿›è¡Œåˆ¤æ–­èµ‹å€¼</p><blockquote><p>æµè§ˆå™¨ä¼šè‡ªåŠ¨è§£æHTMlä»£ç ï¼Œè‡ªåŠ¨åˆ†æå¹¶ä¸”è®¾ç½®<code>DOM Properties</code>ï¼Œä½†æ˜¯Vueæ‰€é‡‡ç”¨çš„æ˜¯vnodeï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±å»æŠŠè¿™ä¸ªæ´»æ¥è¿‡æ¥ã€‚</p></blockquote><p><a name="BbbQ0"></a></p><h6 id="_8-4-classçš„å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_8-4-classçš„å¤„ç†" aria-hidden="true">#</a> 8.4ï¼šclassçš„å¤„ç†</h6><p><code>props</code>ä¸‹çš„<code>class</code>å±æ€§æœ‰ä»¥ä¸‹ä¸‰ç§å®šä¹‰ï¼š</p><ul><li><code>class=&quot;bar foo&quot;</code></li><li><code>:class=&#39;{foo:true,bar:true}&#39;</code></li><li><code>:class=&#39;[&#39;bar&#39;,{foo:true}]&#39;</code></li></ul><p>å¤„ç†è¯¥å±æ€§æœ‰ä¸€ä¸ª<code>normalizeClass</code>å‡½æ•°ï¼Œç”¨æ¥æ•´åˆè¿™äº›å®šä¹‰ï¼Œå…¨éƒ¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„æ ¼å¼<br>è®¾ç½®è¯¥å±æ€§æœ‰<code>el.className</code>,<code>setAttribute</code>,<code>el.classList</code>ä¸‰ç§æ–¹æ³•ï¼Œä½†æ˜¯è€ƒè™‘åˆ°æ€§èƒ½é—®é¢˜ï¼Œæ‰€ä»¥ç”¨çš„æ˜¯<code>el.className</code>ã€‚äºæ˜¯å°±æ˜¯æ¥ç€åœ¨<code>patchProps</code>å‡½æ•°ä¸Šæ‰“è¡¥ä¸</p><blockquote><p>åŒç†ï¼Œ<code>style</code>å±æ€§ä¹Ÿéœ€è¦è¿™ç§æ•´åˆå‡½æ•°è¿›è¡Œå­—ç¬¦ä¸²åŒ–è¿›è¡Œè®¾ç½®</p></blockquote><p><a name="OfDLN"></a></p><h6 id="_8-5-å¸è½½æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#_8-5-å¸è½½æ“ä½œ" aria-hidden="true">#</a> 8.5ï¼šå¸è½½æ“ä½œ</h6><p>é¦–æ¬¡æ¸²æŸ“åï¼ŒåæœŸæ¸²æŸ“çš„<code>vnode</code>å¦‚æœä¼ çš„æ˜¯<code>null</code>è¯´æ˜è¦æ‰§è¡Œå¸è½½æ“ä½œ,ä½†æ˜¯è€ƒè™‘åˆ°ä»¥ä¸‹å‡ ç‚¹é—®é¢˜</p><ul><li>å®¹å™¨å¯èƒ½æ˜¯ç”±å¤šä¸ªç»„ä»¶æ¸²æŸ“ï¼Œå¸è½½æ—¶åº”è¯¥è°ƒç”¨è¿™äº›ç»„ä»¶çš„<code>unmounted</code>ï¼Œ<code>beforeUnmounted</code>ç”Ÿå‘½å‘¨æœŸå‡½æ•°</li><li>æœ‰äº›å…ƒç´ å­˜åœ¨è‡ªå®šä¹‰æŒ‡ä»¤ï¼Œå¸è½½æ—¶åº”è¯¥è¦æ­£ç¡®æ‰§è¡Œå¯¹åº”çš„æŒ‡ä»¤é’©å­</li><li>å¦‚æœç›´æ¥ä½¿ç”¨<code>innerHtml</code>å»æ¸…ç©ºçš„è¯ï¼Œä»–ä¸ä¼šç§»é™¤é‚£äº›ç»‘å®šåœ¨<code>DOM</code>å…ƒç´ ä¸Šçš„é’©å­</li></ul><p>æ‰€ä»¥è€ƒè™‘åˆ°ä»¥ä¸Šä¸‰ç‚¹ï¼Œå¸è½½æ“ä½œï¼Œåº”è¯¥æ˜¯é€šè¿‡<code>vnode</code>è·å–åˆ°çœŸå®<code>DOM</code>,ç„¶åé€šè¿‡<code>DOM</code>çš„åŸç”Ÿæ–¹æ³•è¿›è¡Œç§»é™¤ã€‚åœ¨<code>vnode</code>å¯¹è±¡ä¸Šåˆ›å»ºä¸€ä¸ª<code>el</code>å±æ€§ï¼Œç”¨æ¥è®°å½•çœŸå®<code>DOM</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token number">01</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">02</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span>vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">03</span>     <span class="token function">patch</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span>_vnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> container<span class="token punctuation">)</span>
<span class="token number">04</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token number">05</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>container<span class="token punctuation">.</span>_vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">06</span>       <span class="token comment">// æ ¹æ® vnode è·å–è¦å¸è½½çš„çœŸå® DOM å…ƒç´ </span>
<span class="token number">07</span>       <span class="token keyword">const</span> el <span class="token operator">=</span> container<span class="token punctuation">.</span>_vnode<span class="token punctuation">.</span>el
<span class="token number">08</span>       <span class="token comment">// è·å– el çš„çˆ¶å…ƒç´ </span>
<span class="token number">09</span>       <span class="token keyword">const</span> parent <span class="token operator">=</span> el<span class="token punctuation">.</span>parentNode
<span class="token number">10</span>       <span class="token comment">// è°ƒç”¨ removeChild ç§»é™¤å…ƒç´ </span>
<span class="token number">11</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> parent<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>
<span class="token number">12</span>     <span class="token punctuation">}</span>
<span class="token number">13</span>   <span class="token punctuation">}</span>
<span class="token number">14</span>   container<span class="token punctuation">.</span>_vnode <span class="token operator">=</span> vnode
<span class="token number">15</span> <span class="token punctuation">}</span>
<span class="token number">16</span> <span class="token comment">// container._vnodeæ˜¯oldVnode</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åè€ƒè™‘åˆ°è¯¥æ“ä½œä¼šå¾ˆé¢‘ç¹é¡µå¾ˆå¸¸è§ï¼Œæ‰€ä»¥å°è£…æˆ<code>unmount</code>å‡½æ•°ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token number">01</span> <span class="token keyword">function</span> <span class="token function">unmount</span><span class="token punctuation">(</span><span class="token parameter">vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">02</span>   <span class="token keyword">const</span> parent <span class="token operator">=</span> vnode<span class="token punctuation">.</span>el<span class="token punctuation">.</span>parentNode
<span class="token number">03</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">04</span>     parent<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
<span class="token number">05</span>   <span class="token punctuation">}</span>
<span class="token number">06</span> <span class="token punctuation">}</span>
<span class="token number">07</span> <span class="token comment">// ä¸Šé¢å°±åªéœ€è¦è¿›è¡Œè°ƒç”¨unmount(container._vnode) </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>æ­¤æ—¶è¿˜æœ‰ä¸€ä¸ªå¥½å¤„å°±æ˜¯ï¼Œä»–ç‹¬ç«‹å‡ºå»äº†ï¼Œunmountå’Œbeforeunmountedç”Ÿå‘½å‘¨æœŸå°±å‡ºç°äº†ï¼Œè¿˜å¯ä»¥è¿›è¡Œæ£€æµ‹è¯¥ä¸œä¸œæ˜¯å¦æ˜¯ç»„ä»¶äº†ï¼Œæ˜¯ç»„ä»¶å°±å¯ä»¥è°ƒç”¨å‰é¢æ‰€è¯´çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°</p></blockquote><p><a name="MXrmX"></a></p><h6 id="_8-6-åŒºåˆ†vnodeçš„ç±»å‹" tabindex="-1"><a class="header-anchor" href="#_8-6-åŒºåˆ†vnodeçš„ç±»å‹" aria-hidden="true">#</a> 8.6ï¼šåŒºåˆ†vnodeçš„ç±»å‹</h6><p>å…ˆæ¢³ç†ä¸€ä¸‹æ‰§è¡Œæµç¨‹</p><ol><li>é€šè¿‡<code>createRenderer</code>å‡½æ•°åˆ›å»ºä¸€ä¸ª<code>renderer</code></li><li>é€šè¿‡è°ƒç”¨<code>renderer.render</code>æ–¹æ³•å°†<code>vnode</code>æŒ‚è½½åˆ°<code>container</code>ä¸Š</li><li>æ­¤æ—¶çš„<code>render</code>å‡½æ•°ä¼šè¿›è¡Œåˆ¤æ–­ <ol><li><em>if vnode is null</em> ï¼š<code>unmount(container._vnode)</code></li><li><em>else vnode not is null</em> : <code>patch(oldVnode,newVnode,container)</code></li></ol></li><li>èµ°åˆ°è¿™é‡Œä¸€å®šæ˜¯è¿›è¡Œ<code>patch</code>äº†çš„ï¼Œåˆä¼šè¿›è¡Œåˆ¤æ–­ <ol><li><em>if oldVnode is null :</em><code>mountElement(newVnode,contaienr)</code></li><li><em>else oldVnode not is ï¼š</em><code>patchElement(oldVnode,newVnode)</code></li></ol></li></ol><p><code>patch</code>å‡½æ•°çš„ä½œç”¨æ˜¯å°†æ–°æ—§<code>vnode</code>è¿›è¡Œå¯¹æ¯”ï¼Œç„¶åæŠŠä¸åŒçš„åœ°æ–¹è¿›è¡Œæ›¿æ¢ï¼Œå†æ¸²æŸ“æˆçœŸå®<code>DOM</code>ï¼Œä¸è¿‡è€ƒè™‘åˆ°æ‰€ä¼ è¿›æ¥çš„<code>vnode</code>å¹¶ä¸æ˜¯åŒä¸€ç§ç±»å‹ï¼Œæ­¤æ—¶æ‰€ä½œçš„æ“ä½œåº”è¯¥æ—¶å…ˆå¸è½½<code>oldVnode</code>,å†æŒ‚è½½<code>newVnode</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token number">01</span> <span class="token keyword">function</span> <span class="token function">patch</span><span class="token punctuation">(</span><span class="token parameter">n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">02</span>   <span class="token comment">// å¦‚æœ n1 å­˜åœ¨ï¼Œåˆ™å¯¹æ¯” n1 å’Œ n2 çš„ç±»å‹</span>
<span class="token number">03</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span>n1 <span class="token operator">&amp;&amp;</span> n1<span class="token punctuation">.</span>type <span class="token operator">!==</span> n2<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">04</span>     <span class="token comment">// å¦‚æœæ–°æ—§ vnode çš„ç±»å‹ä¸åŒï¼Œåˆ™ç›´æ¥å°†æ—§ vnode å¸è½½</span>
<span class="token number">05</span>     <span class="token function">unmount</span><span class="token punctuation">(</span>n1<span class="token punctuation">)</span>
<span class="token number">06</span>     n1 <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token number">07</span>   <span class="token punctuation">}</span>
<span class="token number">08</span>
<span class="token number">09</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>n1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">10</span>     <span class="token function">mountElement</span><span class="token punctuation">(</span>n2<span class="token punctuation">,</span> container<span class="token punctuation">)</span>
<span class="token number">11</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token number">12</span>     <span class="token comment">// æ›´æ–°</span>
<span class="token number">13</span>   <span class="token punctuation">}</span>
<span class="token number">14</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œä¸”é™¤äº†ç±»å‹ä¸Šï¼Œå…¶å®ä¸åŒçš„æ ‡ç­¾åº”è¯¥æœ‰ä¸åŒçš„å¤„ç†æ–¹å¼ï¼Œæ‰€ä»¥è¿˜éœ€è¦è¿›ä¸€æ­¥çš„åˆ¤æ–­ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token number">01</span> <span class="token keyword">function</span> <span class="token function">patch</span><span class="token punctuation">(</span><span class="token parameter">n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">02</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span>n1 <span class="token operator">&amp;&amp;</span> n1<span class="token punctuation">.</span>type <span class="token operator">!==</span> n2<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">03</span>     <span class="token function">unmount</span><span class="token punctuation">(</span>n1<span class="token punctuation">)</span>
<span class="token number">04</span>     n1 <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token number">05</span>   <span class="token punctuation">}</span>
<span class="token number">06</span>   <span class="token comment">// ä»£ç è¿è¡Œåˆ°è¿™é‡Œï¼Œè¯æ˜ n1 å’Œ n2 æ‰€æè¿°çš„å†…å®¹ç›¸åŒ</span>
<span class="token number">07</span>   <span class="token keyword">const</span> <span class="token punctuation">{</span> type <span class="token punctuation">}</span> <span class="token operator">=</span> n2
<span class="token number">08</span>   <span class="token comment">// å¦‚æœ n2.type çš„å€¼æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œåˆ™å®ƒæè¿°çš„æ˜¯æ™®é€šæ ‡ç­¾å…ƒç´ </span>
<span class="token number">09</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> type <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">10</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>n1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">11</span>       <span class="token function">mountElement</span><span class="token punctuation">(</span>n2<span class="token punctuation">,</span> container<span class="token punctuation">)</span>
<span class="token number">12</span>     <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token number">13</span>       <span class="token function">patchElement</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span>
<span class="token number">14</span>     <span class="token punctuation">}</span>
<span class="token number">15</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> type <span class="token operator">===</span> <span class="token string">&#39;object&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">16</span>     <span class="token comment">// å¦‚æœ n2.type çš„å€¼çš„ç±»å‹æ˜¯å¯¹è±¡ï¼Œåˆ™å®ƒæè¿°çš„æ˜¯ç»„ä»¶</span>
<span class="token number">17</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">&#39;xxx&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">18</span>     <span class="token comment">// å¤„ç†å…¶ä»–ç±»å‹çš„ vnode</span>
<span class="token number">19</span>   <span class="token punctuation">}</span>
<span class="token number">20</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="T3Vs4"></a></p><h6 id="_8-7-äº‹ä»¶çš„å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_8-7-äº‹ä»¶çš„å¤„ç†" aria-hidden="true">#</a> 8.7ï¼šäº‹ä»¶çš„å¤„ç†</h6><p><code>patchProps</code>å‡½æ•°ï¼šç”¨æ¥å¯¹å…ƒç´ å±æ€§æ‰“è¡¥ä¸çš„å‡½æ•°ã€‚<br>æ˜¯é€šè¿‡<code>createRenderer</code>å†…æ‰€ä¼ çš„<code>options</code>å¸¦æ¥çš„ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token number">01</span> <span class="token function">patchProps</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> key<span class="token punctuation">,</span> prevValue<span class="token punctuation">,</span> nextValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">02</span>   <span class="token comment">// åŒ¹é…ä»¥ on å¼€å¤´çš„å±æ€§ï¼Œè§†å…¶ä¸ºäº‹ä»¶</span>
<span class="token number">03</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^on</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">04</span>     <span class="token comment">// æ ¹æ®å±æ€§åç§°å¾—åˆ°å¯¹åº”çš„äº‹ä»¶åç§°ï¼Œä¾‹å¦‚ onClick ---&gt; click</span>
<span class="token number">05</span>     <span class="token keyword">const</span> name <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">06</span>     <span class="token comment">// ç»‘å®šäº‹ä»¶ï¼ŒnextValue ä¸ºäº‹ä»¶å¤„ç†å‡½æ•°</span>
<span class="token number">07</span>     el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> nextValue<span class="token punctuation">)</span>
<span class="token number">08</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">&#39;class&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">09</span>     <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">10</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">shouldSetAsProps</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> key<span class="token punctuation">,</span> nextValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">11</span>     <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">12</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token number">13</span>     <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">14</span>   <span class="token punctuation">}</span>
<span class="token number">15</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>äº‹ä»¶è¿™ä¸ªä¹Ÿç®—<code>vnode.props</code>é‡Œï¼Œä¸ºäº†æ›´æ˜ç¡®çš„çŸ¥é“å±æ€§é‡Œå“ªä¸ªæ˜¯äº‹ä»¶ï¼Œå°±ç»Ÿä¸€å®‰æ’<code>on</code>ä¸ºå‰ç¼€ï¼Œè¿™æ ·å°±æ–¹ä¾¿å¤„ç†äº†ã€‚<br>é€šè¿‡è°ƒç”¨<code>addEventListener</code>ç»‘å®šäº‹ä»¶ï¼Œæ›´æ–°è·Ÿæ›´æ–°<code>vnode</code>ä¸€æ ·ï¼Œå…ˆå¸è½½ï¼Œåœ¨æŒ‚è½½ã€‚</p><blockquote><p>æ€§èƒ½ä¼˜åŒ–ï¼šåˆ›å»ºåº”è¯¥invoker,å¹¶ä¸”å°†å‡½æ•°ç¼“å­˜åœ¨invoker.valueé‡Œé¢ï¼Œç„¶åè°ƒç”¨çš„æ—¶å€™å°±è°ƒç”¨è¿™ä¸ªï¼Œæ›´æ–°çš„æ—¶å€™è¦†ç›–invoker.valueçš„å€¼å³å¯ï¼Œå°±é¿å…äº†ä¸€æ¬¡removeçš„æ“ä½œ</p></blockquote><p>ä¼˜åŒ–è¿‡æ€§èƒ½åå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šç¼“å­˜åªç¼“å­˜äº†ä¸€ä¸ªï¼Œå‡ºç°å¤šä¸ªäº‹ä»¶ä¼šè¿›è¡Œè¦†ç›–ã€‚<br>è§£å†³ï¼šå°†<code>el._vei</code>è®¾ç½®ä¸ºä¸€ä¸ªå¯¹è±¡ <code>key-&gt;func</code>ã€‚</p><blockquote><p>è¿™é‡Œæœ‰ä¸€ä¸ªæ–°çŸ¥è¯†ï¼Œä¹‹å‰çœ‹è¿‡ä¸€ä¸ªé—®é¢˜ï¼Œjsä¸­çš„objectåº•å±‚æ˜¯ä»€ä¹ˆï¼Œå…¶å®æˆ‘ç¬¬ä¸€æƒ³æ³•æ˜¯key-valueçš„æ•°æ®ç»“æ„ï¼Œç„¶åæˆ‘å»é—®chatgptï¼Œä»–è¯´HashMapï¼ˆç¡®å®å—·ï¼‰<br> åé¢è¿˜æœ‰éœ€æ±‚æ˜¯ä¸€ä¸ªäº‹ä»¶å¯ä»¥ç»‘å®šå¤šä¸ªå‡½æ•°ï¼Œemmmè¿™ç§è¡¥ä¸åŠ ä¸ªåˆ¤æ–­å°±å¥½äº†</p></blockquote><p><a name="Hg9B4"></a></p><h6 id="_8-8-äº‹ä»¶å†’æ³¡ä¸æ›´æ–°æ—¶æœºé—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_8-8-äº‹ä»¶å†’æ³¡ä¸æ›´æ–°æ—¶æœºé—®é¢˜" aria-hidden="true">#</a> 8.8ï¼šäº‹ä»¶å†’æ³¡ä¸æ›´æ–°æ—¶æœºé—®é¢˜</h6><p>é—®é¢˜ä»£ç ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token number">01</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> effect<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token operator">=</span> VueReactivity
<span class="token number">02</span>
<span class="token number">03</span> <span class="token keyword">const</span> bol <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token number">04</span>
<span class="token number">05</span> <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token number">06</span>   <span class="token comment">// åˆ›å»º vnode</span>
<span class="token number">07</span>   <span class="token keyword">const</span> vnode <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token number">08</span>     <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span>
<span class="token number">09</span>     <span class="token literal-property property">props</span><span class="token operator">:</span> bol<span class="token punctuation">.</span>value <span class="token operator">?</span> <span class="token punctuation">{</span>
<span class="token number">10</span>       <span class="token function-variable function">onClick</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token number">11</span>         <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;çˆ¶å…ƒç´  clicked&#39;</span><span class="token punctuation">)</span>
<span class="token number">12</span>       <span class="token punctuation">}</span>
<span class="token number">13</span>     <span class="token punctuation">}</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token number">14</span>     <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token number">15</span>       <span class="token punctuation">{</span>
<span class="token number">16</span>         <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;p&#39;</span><span class="token punctuation">,</span>
<span class="token number">17</span>         <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token number">18</span>           <span class="token function-variable function">onClick</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token number">19</span>             bol<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token number">20</span>           <span class="token punctuation">}</span>
<span class="token number">21</span>         <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token number">22</span>         <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token string">&#39;text&#39;</span>
<span class="token number">23</span>       <span class="token punctuation">}</span>
<span class="token number">24</span>     <span class="token punctuation">]</span>
<span class="token number">25</span>   <span class="token punctuation">}</span>
<span class="token number">26</span>   <span class="token comment">// æ¸²æŸ“ vnode</span>
<span class="token number">27</span>   renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#app&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token number">28</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤æ—¶ç‚¹å‡»<code>p</code>ä¼šè§¦å‘ä»–çš„ç‚¹å‡»äº‹ä»¶ï¼Œç”±äºç»‘å®šäº†ä¸€ä¸ª<code>ref</code>å˜é‡ï¼Œçˆ¶å…ƒç´ <code>div</code>çš„åˆ†æ”¯åº”è¯¥æ˜¯å¤„äº<code>{}</code>,å°±ç®—äº‹ä»¶å†’æ³¡ï¼Œä¹Ÿä¸éœ€è¦è¿›è¡Œè§¦å‘ç‚¹å‡»äº‹ä»¶ã€‚ä½†æ˜¯ç»“æœå´æ˜¯è§¦å‘äº†ï¼Œçœ‹ä¸‹å›¾ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/27119990/1679638067368-def3acdd-bdcb-4a94-9e46-6a40bdef7fd5.png#averageHue=%23d8d8d8&amp;clientId=u8ad3f223-1d49-4&amp;from=paste&amp;height=446&amp;id=u74f5d236&amp;originHeight=1020&amp;originWidth=1034&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=192021&amp;status=done&amp;style=none&amp;taskId=u6b87793b-1ccf-46dc-9aab-6204ea877ff&amp;title=&amp;width=452" alt="image.png" loading="lazy"><br>åœ¨ç‚¹å‡»åï¼Œä»–ä¿®æ”¹äº†<code>ref</code>å˜é‡ï¼Œäºæ˜¯æ‰§è¡Œäº†å‰¯ä½œç”¨å‡½æ•°ï¼Œè¿›è¡Œé‡æ–°æ¸²æŸ“ï¼Œæå‰æ”¹å˜äº†ä½¿å¾—<code>div</code>çš„ç‚¹å‡»äº‹ä»¶è¿›è¡Œäº†åˆ†æ”¯åˆ‡æ¢ï¼Œå¹¶ä¸”ç»‘å®šåˆ°äº†<code>div</code>ä¸Šï¼Œæ‰€ä»¥ä¼šè§¦å‘<code>div</code>çš„ç‚¹å‡»äº‹ä»¶ã€‚<br>è§£å†³æ–¹æ¡ˆï¼šåˆ¤æ–­ç»‘å®šäº‹ä»¶çš„æ—¶é—´æ˜¯å¦å°äºè§¦å‘äº‹ä»¶å³å¯ã€‚</p><blockquote><p>æˆ‘çœ‹åˆ°è¿™çš„æ—¶å€™ç¬¬ä¸€æƒ³æ³•æ˜¯ï¼Œå°†æ¸²æŸ“å¾€åæ¨ï¼Œå†’æ³¡å¾€å‰èµ°ï¼Œä½†æ˜¯è€ƒè™‘åˆ°å†’æ³¡çš„äº‹ä»¶ä½•æ—¶å¼€å§‹ä¸ä½•æ—¶ç»“æŸéƒ½æ˜¯ä¸å¯é¢„æ–™çš„ï¼Œæ‰€ä»¥è¡Œä¸é€š</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token number">01</span> <span class="token function">patchProps</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> key<span class="token punctuation">,</span> prevValue<span class="token punctuation">,</span> nextValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">02</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^on</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">03</span>     <span class="token keyword">const</span> invokers <span class="token operator">=</span> el<span class="token punctuation">.</span>_vei <span class="token operator">||</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>_vei <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token number">04</span>     <span class="token keyword">let</span> invoker <span class="token operator">=</span> invokers<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
<span class="token number">05</span>     <span class="token keyword">const</span> name <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">06</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>nextValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">07</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>invoker<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">08</span>         invoker <span class="token operator">=</span> el<span class="token punctuation">.</span>_vei<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token number">09</span>           <span class="token comment">// e.timeStamp æ˜¯äº‹ä»¶å‘ç”Ÿçš„æ—¶é—´</span>
<span class="token number">10</span>           <span class="token comment">// å¦‚æœäº‹ä»¶å‘ç”Ÿçš„æ—¶é—´æ—©äºäº‹ä»¶å¤„ç†å‡½æ•°ç»‘å®šçš„æ—¶é—´ï¼Œåˆ™ä¸æ‰§è¡Œäº‹ä»¶å¤„ç†å‡½æ•°</span>
<span class="token number">11</span>           <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>timeStamp <span class="token operator">&lt;</span> invoker<span class="token punctuation">.</span>attached<span class="token punctuation">)</span> <span class="token keyword">return</span>
<span class="token number">12</span>           <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>invoker<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">13</span>             invoker<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token number">14</span>           <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token number">15</span>             invoker<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token number">16</span>           <span class="token punctuation">}</span>
<span class="token number">17</span>         <span class="token punctuation">}</span>
<span class="token number">18</span>         invoker<span class="token punctuation">.</span>value <span class="token operator">=</span> nextValue
<span class="token number">19</span>         <span class="token comment">// æ·»åŠ  invoker.attached å±æ€§ï¼Œå­˜å‚¨äº‹ä»¶å¤„ç†å‡½æ•°è¢«ç»‘å®šçš„æ—¶é—´</span>
<span class="token number">20</span>         invoker<span class="token punctuation">.</span>attached <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">21</span>         el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> invoker<span class="token punctuation">)</span>
<span class="token number">22</span>       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token number">23</span>         invoker<span class="token punctuation">.</span>value <span class="token operator">=</span> nextValue
<span class="token number">24</span>       <span class="token punctuation">}</span>
<span class="token number">25</span>     <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>invoker<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">26</span>       el<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> invoker<span class="token punctuation">)</span>
<span class="token number">27</span>     <span class="token punctuation">}</span>
<span class="token number">28</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">&#39;class&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">29</span>     <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">30</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">shouldSetAsProps</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> key<span class="token punctuation">,</span> nextValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">31</span>     <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">32</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token number">33</span>     <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">34</span>   <span class="token punctuation">}</span>
<span class="token number">35</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>æ¥è‡ªä¹¦ä¸­çš„è¡¥å……ï¼š<br> â€œåœ¨å…³äºæ—¶é—´çš„å­˜å‚¨å’Œæ¯”è¾ƒæ–¹é¢ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯é«˜ç²¾æ—¶é—´ï¼Œå³ performance.nowã€‚ä½†æ ¹æ®æµè§ˆå™¨çš„ä¸åŒï¼Œe.timeStamp çš„å€¼ä¹Ÿä¼šæœ‰æ‰€ä¸åŒã€‚å®ƒæ—¢å¯èƒ½æ˜¯é«˜ç²¾æ—¶é—´ï¼Œä¹Ÿå¯èƒ½æ˜¯éé«˜ç²¾æ—¶é—´ã€‚å› æ­¤ï¼Œä¸¥æ ¼æ¥è®²ï¼Œè¿™é‡Œéœ€è¦åšå…¼å®¹å¤„ç†ã€‚ä¸è¿‡åœ¨ Chrome 49ã€Firefox 54ã€Opera 36 ä»¥åŠä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œe.timeStamp çš„å€¼éƒ½æ˜¯é«˜ç²¾æ—¶é—´ã€‚â€</p></blockquote><p><a name="u1Lij"></a></p><h6 id="_8-9-æ›´æ–°å­èŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#_8-9-æ›´æ–°å­èŠ‚ç‚¹" aria-hidden="true">#</a> 8.9ï¼šæ›´æ–°å­èŠ‚ç‚¹</h6><p>å­å…ƒç´ çš„çŠ¶æ€ï¼š</p><ul><li>æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œæ­¤æ—¶ vnode.children çš„å€¼ä¸º nullã€‚</li><li>å…·æœ‰æ–‡æœ¬å­èŠ‚ç‚¹ï¼Œæ­¤æ—¶ vnode.children çš„å€¼ä¸ºå­—ç¬¦ä¸²ï¼Œä»£è¡¨æ–‡æœ¬çš„å†…å®¹ã€‚</li><li>å…¶ä»–æƒ…å†µï¼Œæ— è®ºæ˜¯å•ä¸ªå…ƒç´ å­èŠ‚ç‚¹ï¼Œè¿˜æ˜¯å¤šä¸ªå­èŠ‚ç‚¹ï¼ˆå¯èƒ½æ˜¯æ–‡æœ¬å’Œå…ƒç´ çš„æ··åˆï¼‰ï¼Œéƒ½å¯ä»¥ç”¨æ•°ç»„æ¥è¡¨ç¤ºã€‚</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token number">01</span> <span class="token comment">// æ²¡æœ‰å­èŠ‚ç‚¹</span>
<span class="token number">02</span> vnode <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token number">03</span>   <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span>
<span class="token number">04</span>   <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token number">05</span> <span class="token punctuation">}</span>
<span class="token number">06</span> <span class="token comment">// æ–‡æœ¬å­èŠ‚ç‚¹</span>
<span class="token number">07</span> vnode <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token number">08</span>   <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span>
<span class="token number">09</span>   <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token string">&#39;Some Text&#39;</span>
<span class="token number">10</span> <span class="token punctuation">}</span>
<span class="token number">11</span> <span class="token comment">// å…¶ä»–æƒ…å†µï¼Œå­èŠ‚ç‚¹ä½¿ç”¨æ•°ç»„è¡¨ç¤º</span>
<span class="token number">12</span> vnode <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token number">13</span>   <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span>
<span class="token number">14</span>   <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token number">15</span>     <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;p&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token number">16</span>     <span class="token string">&#39;Some Text&#39;</span>
<span class="token number">17</span>   <span class="token punctuation">]</span>
<span class="token number">18</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>patchElement</code>å‡½æ•°ä¸»è¦æ‰§è¡Œä¸¤ä¸ªåŠŸèƒ½</p><ul><li><code>patchProps</code></li><li><code>patchChildren</code></li></ul><p>è¿™ç« ä¸»è¦è®²çš„æ˜¯<code>patchChildren</code>å‡½æ•°ã€‚</p><blockquote><p>å¯¹äºæ›´æ–°childrenï¼Œæˆ‘çš„æƒ³æ³•æ˜¯ï¼Œå¸è½½åŸæœ‰çš„ï¼Œå®‰è£…æ–°çš„ã€‚ä¸è¿‡ä¸ºäº†ä½¿è¿™ä¸ªæ–¹æ³•æ›´åŠ å¼ºå¤§ï¼Œæ‰€ä»¥éœ€è¦åšä¸€äº›åˆ¤æ–­</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token number">01</span> <span class="token keyword">function</span> <span class="token function">patchChildren</span><span class="token punctuation">(</span><span class="token parameter">n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">02</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> n2<span class="token punctuation">.</span>children <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">03</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>n1<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">04</span>       n1<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">unmount</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token number">05</span>     <span class="token punctuation">}</span>
<span class="token number">06</span>     <span class="token function">setElementText</span><span class="token punctuation">(</span>container<span class="token punctuation">,</span> n2<span class="token punctuation">.</span>children<span class="token punctuation">)</span>
<span class="token number">07</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>n2<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">08</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>n1<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">09</span>       <span class="token comment">// diff</span>
<span class="token number">10</span>     <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token number">11</span>       <span class="token function">setElementText</span><span class="token punctuation">(</span>container<span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
<span class="token number">12</span>       n2<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=&gt;</span> <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token number">13</span>     <span class="token punctuation">}</span>
<span class="token number">14</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token number">15</span>     <span class="token comment">// ä»£ç è¿è¡Œåˆ°è¿™é‡Œï¼Œè¯´æ˜æ–°å­èŠ‚ç‚¹ä¸å­˜åœ¨</span>
<span class="token number">16</span>     <span class="token comment">// æ—§å­èŠ‚ç‚¹æ˜¯ä¸€ç»„å­èŠ‚ç‚¹ï¼Œåªéœ€é€ä¸ªå¸è½½å³å¯</span>
<span class="token number">17</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>n1<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">18</span>       n1<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=&gt;</span> <span class="token function">unmount</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token number">19</span>     <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> n1<span class="token punctuation">.</span>children <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">20</span>       <span class="token comment">// æ—§å­èŠ‚ç‚¹æ˜¯æ–‡æœ¬å­èŠ‚ç‚¹ï¼Œæ¸…ç©ºå†…å®¹å³å¯</span>
<span class="token number">21</span>       <span class="token function">setElementText</span><span class="token punctuation">(</span>container<span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
<span class="token number">22</span>     <span class="token punctuation">}</span>
<span class="token number">23</span>     <span class="token comment">// å¦‚æœä¹Ÿæ²¡æœ‰æ—§å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆä»€ä¹ˆéƒ½ä¸éœ€è¦åš</span>
<span class="token number">24</span>   <span class="token punctuation">}</span>
<span class="token number">25</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»£ç å¦‚ä¸Šï¼Œåˆ†æå¦‚ä¸‹ï¼š</p><ol><li><em>åˆ¤æ–­</em><code>_newVnode_</code><em>æ˜¯å¦æ˜¯</em><code>_string_</code><ol><li><em>å¦‚æœæ˜¯ï¼Œåˆ™åˆ¤æ–­</em><code>_oldVnode_</code><em>æ˜¯å¦æ˜¯æ•°ç»„</em><ol><li><em>å¦‚æœæ˜¯å°±é€ä¸ªå¸è½½ï¼Œå¹¶ä¸”æŒ‚åœ¨æ–‡æœ¬</em></li></ol></li><li><em>ä¸æ˜¯æ•°ç»„å°±ä¸éœ€è¦ç®¡ï¼Œç›´æ¥æŒ‚è½½æ–‡æœ¬</em></li></ol></li><li><em>å½“ä¸æ˜¯</em><code>_string_</code><em>çš„æ—¶å€™ï¼Œåˆ¤æ–­</em><code>_newVnode_</code><em>æ˜¯å¦æ˜¯æ•°ç»„</em><ol><li><em>å¦‚æœæ˜¯ï¼Œåˆ™åˆ¤æ–­</em><code>_oldVnode_</code><em>æ˜¯å¦æ˜¯æ•°ç»„</em><ol><li><code>_Diff_</code><em>ç®—æ³•</em></li></ol></li><li><em>å¸è½½æ–‡æœ¬ï¼Œå†æŒ‚è½½æ•°ç»„</em></li></ol></li><li><em>æ—¢ä¸æ˜¯</em><code>_string_</code><em>,ä¹Ÿä¸æ˜¯æ•°ç»„ï¼Œè¿™é‡Œçš„</em><code>_newVnode_</code><em>å°±ä¸€å®šæ—¶ç©ºäº†</em><ol><li><em>é‡å¤å¦‚ç¬¬ä¸€æ­¥çš„æ“ä½œä¸€æ ·ï¼Œåªéœ€è¦æŠŠåé¢æŒ‚è½½æ–‡æœ¬æ”¹æˆæŒ‚åœ¨</em><code>_&#39;&#39;_</code><br><a name="OqUF5"></a></li></ol></li></ol><h6 id="_8-10-æ–‡æœ¬æ³¨é‡Šå’Œæ³¨é‡ŠèŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#_8-10-æ–‡æœ¬æ³¨é‡Šå’Œæ³¨é‡ŠèŠ‚ç‚¹" aria-hidden="true">#</a> 8.10ï¼šæ–‡æœ¬æ³¨é‡Šå’Œæ³¨é‡ŠèŠ‚ç‚¹</h6><p>...<br><a name="VeleT"></a></p><h6 id="_8-11-fragment" tabindex="-1"><a class="header-anchor" href="#_8-11-fragment" aria-hidden="true">#</a> 8.11ï¼šFragment</h6><p>åä¸ºç‰‡æ®µï¼Œä½œç”¨æ˜¯è§£å†³äº†vue2ä¸æ”¯æŒå¤šæ ¹èŠ‚ç‚¹æ¨¡æ¿çš„é—®é¢˜ã€‚</p><p><a name="dwKG1"></a></p><h6 id="_8-12-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_8-12-æ€»ç»“" aria-hidden="true">#</a> 8.12ï¼šæ€»ç»“</h6><p>ç« èŠ‚æ€»ç»“è‡ªå·±ç¿»ä¹¦ã€‚</p><hr><p>1.<code>render</code>å‡½æ•°ï¼š</p><ol><li>é¦–å…ˆè°ƒç”¨<code>render</code>å‡½æ•°ï¼Œä¼ é€’<code>vnode</code>ï¼Œ<code>container</code>ä¸¤ä¸ªå‚æ•° <ol><li>è¿›å…¥<code>render</code>å‡½æ•°åä¼šè¿›è¡Œåˆ¤æ–­<code>vnode</code>æ˜¯å¦æ˜¯<code>null</code><ol><li>æ˜¯<code>null</code>åˆ™è¿›è¡Œ<code>unmount</code>çš„æ“ä½œ</li><li>åä¹‹åˆ™è¿›è¡Œ<code>patch</code>æ“ä½œï¼Œè¿›è¡Œå¯¹<code>oldVnode</code>å’Œ<code>newVnode</code>æ¯”è¾ƒ</li></ol></li></ol></li></ol><hr><p>2.<code>patch</code>å‡½æ•°ï¼š</p><ol><li>è¿›å…¥<code>patch</code>å‡½æ•°ååˆ¤æ–­æ–°æ—§<code>vnode</code>çš„ç±»å‹æ˜¯å¦ä¸€æ ·ï¼Œä¸æ˜¯ä¸€æ ·å°±å…ˆå¸è½½<code>oldVnode</code></li><li>å–å‡º<code>newVnode</code>çš„ç±»å‹ï¼Œè¿™é‡Œæœ‰<code>Text</code>ï¼Œ<code>Comment</code>ï¼Œ<code>Fragment</code>ï¼Œ<code>Static</code>ï¼Œ<code>default</code><ol><li>å¦‚æœæ˜¯å‰å››ç§ç±»å‹çš„èŠ‚ç‚¹ï¼Œåˆ™ä¼šè°ƒç”¨å¯¹åº”çš„<code>process</code>æ–¹æ³•è¿›è¡ŒæŒ‚è½½åˆ°<code>container</code>ä¸Š</li><li>è¿™ä¸ªåˆ†æ”¯æ˜¯<code>default</code>çš„æ‰§è¡Œï¼Œä¼šåˆ¤æ–­èŠ‚ç‚¹æ˜¯ç»„ä»¶è¿˜æ˜¯èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯èŠ‚ç‚¹åˆ™è°ƒç”¨<code>processElement</code>æ–¹æ³•ï¼Œåä¹‹åˆ™è°ƒç”¨<code>processComponent</code>æ–¹æ³•</li></ol></li></ol><hr><p>3.<code>processElement</code>å‡½æ•°ï¼š</p><ol><li>åˆ¤æ–­<code>oldVnode</code>æ˜¯å¦æ˜¯ç©ºï¼Œæ˜¯ç©ºçš„è¯åˆ™è°ƒç”¨<code>mountElement</code>æ–¹æ³•</li><li>åä¹‹è°ƒç”¨<code>patchElement</code>æ–¹æ³•</li></ol><hr><p>4.<code>mountElement</code>å‡½æ•°ï¼š</p><ol><li>å› ä¸ºæ˜¯ç¬¬ä¸€æ¬¡æŒ‚è½½ï¼Œè¿›è¡Œåˆ›å»º<code>DOM el</code></li><li>ç„¶ååˆ¤æ–­<code>children</code>ç±»å‹æ˜¯<code>string</code>è¿˜æ˜¯<code>array</code><ol><li>æ˜¯<code>string</code>åˆ™è¿›è¡ŒæŒ‚è½½æ–‡æœ¬</li><li>åä¹‹è¿›è¡Œå¾ªç¯éå†æ•°ç»„è¿›è¡Œ<code>patch</code>å­èŠ‚ç‚¹</li></ol></li><li>è°ƒç”¨<code>patchProps</code>å‡½æ•°æ·»åŠ å±æ€§</li></ol><hr><p>5.<code>patchProps</code>å‡½æ•°ï¼š</p><ol><li>å¯¹äº<code>class</code>ï¼Œ<code>style</code>ï¼Œ<code>event</code>éƒ½æ˜¯ç‰¹æ®Šå±æ€§ï¼Œéœ€è¦åšç‰¹æ®Šå¤„ç†ï¼Œè°ƒç”¨å¯¹åº”çš„<code>patch-</code>å‡½æ•°</li><li>é™¤äº†ä»¥ä¸Šä¸‰ä¸ªï¼Œå°±æ˜¯å±æ€§äº†ï¼Œæ ¹æ®å±æ€§è‡ªèº«ç‰¹æ€§è¿›è¡Œå¯¹åº”æŒ‚è½½ã€‚</li><li>è¿˜æœ‰<code>vue</code>çš„æŒ‡ä»¤æŒ‚è½½</li></ol><hr><p>5.<code>patchElement</code>å‡½æ•°ï¼š</p><ol><li>æ›´æ–°<code>props</code>é€šè¿‡è°ƒç”¨<code>patchProps</code>æ–¹æ³•</li><li>æ›´æ–°<code>children</code>é€šè¿‡è°ƒç”¨<code>patchChildren</code></li></ol><blockquote><p>æºç é‡Œé¢å…¶å®è¿˜åšäº†å…¶ä»–çš„æ“ä½œï¼Œè€Œä¸”patchï¼Œåº”è¯¥æ¥ç€patchæŒ‡ä»¤ï¼Œæˆ‘è¿™äº›æ€»ç»“æ˜¯ä¸€éƒ¨åˆ†ä¹¦ä¸Šä¸€éƒ¨åˆ†æºç ä¸Šçš„ï¼Œå‡½æ•°åéƒ½èƒ½ä»æºç é‡Œæ‰¾åˆ°çš„</p></blockquote><hr><p>6.<code>patchChildren</code>å‡½æ•°ï¼š</p><ol><li>åˆ¤æ–­<code>newVnode.children</code>æ˜¯ä¸æ˜¯<code>string</code><ol><li>åˆ¤æ–­<code>oldVnode.children</code>æ˜¯ä¸æ˜¯<code>array</code>æ˜¯çš„è¯å°±å¾ªç¯å¸è½½<code>oldVnode.children</code></li></ol></li><li>åˆ¤æ–­<code>newVnode.children</code>æ˜¯ä¸æ˜¯<code>array</code><ol><li>åˆ¤æ–­<code>oldVnode.children</code>æ˜¯ä¸æ˜¯<code>array</code>,å¦‚æœæ˜¯å°±è¿›è¡Œ<code>diff</code>ç®—æ³•ï¼Œåä¹‹åˆ™å¾ªç¯æŒ‚è½½<code>newVnode.children</code></li></ol></li><li>æ—¢ä¸æ˜¯<code>string</code>ä¹Ÿä¸æ˜¯<code>array</code>,é‚£åªèƒ½æ˜¯<code>null</code><ol><li>å¸è½½<code>oldVnode</code><br><a name="SyGDk"></a></li></ol></li></ol><h5 id="vueè®¾è®¡ä¸å®ç°ç¬¬ä¹ç« -ç®€å•diffç®—æ³•" tabindex="-1"><a class="header-anchor" href="#vueè®¾è®¡ä¸å®ç°ç¬¬ä¹ç« -ç®€å•diffç®—æ³•" aria-hidden="true">#</a> vueè®¾è®¡ä¸å®ç°ç¬¬ä¹ç« ï¼šç®€å•Diffç®—æ³•</h5><p><a name="x9aMU"></a></p><h6 id="_9-1-å‡å°‘domæ“ä½œçš„æ€§èƒ½å¼€é”€" tabindex="-1"><a class="header-anchor" href="#_9-1-å‡å°‘domæ“ä½œçš„æ€§èƒ½å¼€é”€" aria-hidden="true">#</a> 9.1ï¼šå‡å°‘DOMæ“ä½œçš„æ€§èƒ½å¼€é”€</h6><p>æ—§çš„<code>patchChildren</code>åœ¨å¤„ç†æ–°æ—§<code>vnode</code>éƒ½æ˜¯<code>array</code>æ—¶ï¼Œæ˜¯å…ˆå…¨éƒ¨å¸è½½<code>oldVnode</code>,å†æŒ‚è½½<code>newVnode</code>ï¼Œç®—æ³•çš„æˆæœ¬å¾ˆå¤§ã€‚æœ‰æ—¶å€™æœ‰ä¸€äº›èŠ‚ç‚¹ï¼Œå•çº¯å¯èƒ½åªæ˜¯æ–‡æœ¬å€¼æ”¹å˜äº†ï¼Œå¹¶ä¸éœ€è¦å¸è½½å’ŒæŒ‚è½½æ“ä½œï¼Œåªéœ€è¦æ›´æ–°æ–‡æœ¬å€¼å³å¯ã€‚äºæ˜¯<code>diff</code>ç®—æ³•å°±æ˜¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚<br>æ–¹æ¡ˆä¸€ï¼šé€ä¸ªæ¯”è¾ƒæ–°æ—§<code>vnode.children</code>ï¼Œè§£å†³äº†<code>DOM</code>çš„å¼€é”€ï¼Œä½†é—®é¢˜å´æ˜¯ï¼Œå¦‚æœæ–°æ—§<code>vnode</code>çš„ä¸ªæ•°ä¸ä¸€æ ·ï¼Œæ‰€ä»¥éœ€è¦è€ƒè™‘æ–°æ—§<code>vnode.children</code>çš„é•¿åº¦ï¼Œæ—§çš„å¤šäº†åº”è¯¥å¸è½½ï¼Œæ–°çš„å¤šäº†åº”è¯¥æŒ‚è½½ï¼Œä¸èƒ½åªæ˜¯å•çº¯çš„æ›´æ–°ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token number">01</span> <span class="token keyword">function</span> <span class="token function">patchChildren</span><span class="token punctuation">(</span><span class="token parameter">n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">02</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> n2<span class="token punctuation">.</span>children <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">03</span>     <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">04</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>n2<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">05</span>     <span class="token keyword">const</span> oldChildren <span class="token operator">=</span> n1<span class="token punctuation">.</span>children
<span class="token number">06</span>     <span class="token keyword">const</span> newChildren <span class="token operator">=</span> n2<span class="token punctuation">.</span>children
<span class="token number">07</span>     <span class="token comment">// æ—§çš„ä¸€ç»„å­èŠ‚ç‚¹çš„é•¿åº¦</span>
<span class="token number">08</span>     <span class="token keyword">const</span> oldLen <span class="token operator">=</span> oldChildren<span class="token punctuation">.</span>length
<span class="token number">09</span>     <span class="token comment">// æ–°çš„ä¸€ç»„å­èŠ‚ç‚¹çš„é•¿åº¦</span>
<span class="token number">10</span>     <span class="token keyword">const</span> newLen <span class="token operator">=</span> newChildren<span class="token punctuation">.</span>length
<span class="token number">11</span>     <span class="token comment">// ä¸¤ç»„å­èŠ‚ç‚¹çš„å…¬å…±é•¿åº¦ï¼Œå³ä¸¤è€…ä¸­è¾ƒçŸ­çš„é‚£ä¸€ç»„å­èŠ‚ç‚¹çš„é•¿åº¦</span>
<span class="token number">12</span>     <span class="token keyword">const</span> commonLength <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>oldLen<span class="token punctuation">,</span> newLen<span class="token punctuation">)</span>
<span class="token number">13</span>     <span class="token comment">// éå† commonLength æ¬¡</span>
<span class="token number">14</span>     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> commonLength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">15</span>       <span class="token function">patch</span><span class="token punctuation">(</span>oldChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> newChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> container<span class="token punctuation">)</span>
<span class="token number">16</span>     <span class="token punctuation">}</span>
<span class="token number">17</span>     <span class="token comment">// å¦‚æœ newLen &gt; oldLenï¼Œè¯´æ˜æœ‰æ–°å­èŠ‚ç‚¹éœ€è¦æŒ‚è½½</span>
<span class="token number">18</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>newLen <span class="token operator">&gt;</span> oldLen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">19</span>       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> commonLength<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> newLen<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">20</span>         <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> newChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> container<span class="token punctuation">)</span>
<span class="token number">21</span>       <span class="token punctuation">}</span>
<span class="token number">22</span>     <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldLen <span class="token operator">&gt;</span> newLen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">23</span>       <span class="token comment">// å¦‚æœ oldLen &gt; newLenï¼Œè¯´æ˜æœ‰æ—§å­èŠ‚ç‚¹éœ€è¦å¸è½½</span>
<span class="token number">24</span>       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> commonLength<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> oldLen<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">25</span>         <span class="token function">unmount</span><span class="token punctuation">(</span>oldChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token number">26</span>       <span class="token punctuation">}</span>
<span class="token number">27</span>     <span class="token punctuation">}</span>
<span class="token number">28</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token number">29</span>     <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">30</span>   <span class="token punctuation">}</span>
<span class="token number">31</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="ilIY2"></a></p><h6 id="_9-2-domå¤ç”¨å’Œkeyçš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#_9-2-domå¤ç”¨å’Œkeyçš„ä½œç”¨" aria-hidden="true">#</a> 9.2ï¼šDOMå¤ç”¨å’Œkeyçš„ä½œç”¨</h6><p>æœ‰äº›æ—¶å€™ï¼Œæ–°æ—§<code>vnode.children</code>çš„å†…å®¹æœ‰å¾ˆå¤šç›¸åŒï¼Œä¸éœ€è¦åšæ”¹åŠ¨çš„æ“ä½œï¼Œè¿™ä¸ªæ—¶å€™ï¼Œè¿™äº›ç›¸åŒçš„<code>DOM</code>æ˜¯å¯ä»¥ä¿ç•™ä¸‹é¢ï¼Œä¸éœ€è¦æ›´æ–°ä¹Ÿä¸éœ€è¦æŒ‚è½½å’Œå¸è½½ï¼Œæ‰€ä»¥ä¸‹ä¸€ä¸ªä¼˜åŒ–æ–¹å‘æ˜¯ï¼Œå¦‚ä½•çŸ¥é“è¿™ä¸ª<code>DOM</code>æ—¢å‡ºç°åœ¨<code>oldVnode.children</code>ï¼Œä¹Ÿå‡ºç°åœ¨<code>newVnode.children</code>ã€‚<br>å¼•å…¥<code>key</code>,å”¯ä¸€æ ‡è¯†ç¬¦ã€‚è¿™æ ·å°±å¯ä»¥çŸ¥é“åœ¨ä¸åœ¨äº†ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/27119990/1679812023829-38ae91c1-3fc6-445c-95d1-9dbaba92d073.png#averageHue=%23ebebeb&amp;clientId=uc9d64d88-5777-4&amp;from=paste&amp;height=244&amp;id=u5adc75c1&amp;originHeight=244&amp;originWidth=635&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=38084&amp;status=done&amp;style=none&amp;taskId=u1afe2894-cf34-4bf5-87ea-940b34303dd&amp;title=&amp;width=635" alt="image.png" loading="lazy"><br>ä½†æ˜¯ï¼Œ<code>key</code>ç›¸åŒï¼Œå¹¶ä¸ä¸€å®šæ„å‘³ç€å¯ä»¥ç›´æ¥å¤ç”¨ï¼Œä»–ä»¬çš„<code>children</code>å¯èƒ½ä¼šä¸ä¸€æ ·ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token number">01</span> <span class="token keyword">function</span> <span class="token function">patchChildren</span><span class="token punctuation">(</span><span class="token parameter">n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">02</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> n2<span class="token punctuation">.</span>children <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">03</span>     <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">04</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>n2<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">05</span>     <span class="token keyword">const</span> oldChildren <span class="token operator">=</span> n1<span class="token punctuation">.</span>children
<span class="token number">06</span>     <span class="token keyword">const</span> newChildren <span class="token operator">=</span> n2<span class="token punctuation">.</span>children
<span class="token number">07</span>
<span class="token number">08</span>     <span class="token comment">// éå†æ–°çš„ children</span>
<span class="token number">09</span>     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> newChildren<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">10</span>       <span class="token keyword">const</span> newVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
<span class="token number">11</span>       <span class="token comment">// éå†æ—§çš„ children</span>
<span class="token number">12</span>       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> oldChildren<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">13</span>         <span class="token keyword">const</span> oldVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
<span class="token number">14</span>         <span class="token comment">// å¦‚æœæ‰¾åˆ°äº†å…·æœ‰ç›¸åŒ key å€¼çš„ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œè¯´æ˜å¯ä»¥å¤ç”¨ï¼Œä½†ä»ç„¶éœ€è¦è°ƒç”¨ patch å‡½æ•°æ›´æ–°</span>
<span class="token number">15</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span>newVNode<span class="token punctuation">.</span>key <span class="token operator">===</span> oldVNode<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">16</span>           <span class="token function">patch</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">,</span> newVNode<span class="token punctuation">,</span> container<span class="token punctuation">)</span>
<span class="token number">17</span>           <span class="token keyword">break</span> <span class="token comment">// è¿™é‡Œéœ€è¦ break</span>
<span class="token number">18</span>         <span class="token punctuation">}</span>
<span class="token number">19</span>       <span class="token punctuation">}</span>
<span class="token number">20</span>     <span class="token punctuation">}</span>
<span class="token number">21</span>
<span class="token number">22</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token number">23</span>     <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">24</span>   <span class="token punctuation">}</span>
<span class="token number">25</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="NOGZI"></a></p><h6 id="_9-3-æ‰¾åˆ°éœ€è¦ç§»åŠ¨çš„å…ƒç´ " tabindex="-1"><a class="header-anchor" href="#_9-3-æ‰¾åˆ°éœ€è¦ç§»åŠ¨çš„å…ƒç´ " aria-hidden="true">#</a> 9.3ï¼šæ‰¾åˆ°éœ€è¦ç§»åŠ¨çš„å…ƒç´ </h6><p>ä¸Šé¢è§£å†³äº†æ‰¾åˆ°å¯å¤ç”¨çš„èŠ‚ç‚¹ã€‚è¿™é‡Œå°±æ˜¯ç”¨æ¥è€ƒè™‘è¯¥èŠ‚ç‚¹æ˜¯å¦éœ€è¦ç§»åŠ¨ã€‚<br>å¦‚ä½•åˆ¤æ–­è¯¥å…ƒç´ éœ€è¦ç§»åŠ¨ï¼šå¦‚æœç´¢å¼•å€¼å…·æœ‰å•è°ƒé€’å¢çš„ç‰¹æ€§ï¼Œè¯´æ˜ä¸éœ€è¦ç§»åŠ¨ï¼Œä½†æ˜¯ä¸­é€”æœ‰ç´¢å¼•æ¯”å½“å‰çŠ¶æ€ä¸‹çš„æœ€å¤§ç´¢å¼•è¦å°ï¼Œè¯´æ˜è¯¥èŠ‚ç‚¹éœ€è¦ç§»åŠ¨ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token number">01</span> <span class="token keyword">function</span> <span class="token function">patchChildren</span><span class="token punctuation">(</span><span class="token parameter">n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">02</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> n2<span class="token punctuation">.</span>children <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">03</span>     <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">04</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>n2<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">05</span>     <span class="token keyword">const</span> oldChildren <span class="token operator">=</span> n1<span class="token punctuation">.</span>children
<span class="token number">06</span>     <span class="token keyword">const</span> newChildren <span class="token operator">=</span> n2<span class="token punctuation">.</span>children
<span class="token number">07</span>
<span class="token number">08</span>     <span class="token comment">// ç”¨æ¥å­˜å‚¨å¯»æ‰¾è¿‡ç¨‹ä¸­é‡åˆ°çš„æœ€å¤§ç´¢å¼•å€¼</span>
<span class="token number">09</span>     <span class="token keyword">let</span> lastIndex <span class="token operator">=</span> <span class="token number">0</span>
<span class="token number">10</span>     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> newChildren<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">11</span>       <span class="token keyword">const</span> newVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
<span class="token number">12</span>       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> oldChildren<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">13</span>         <span class="token keyword">const</span> oldVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
<span class="token number">14</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span>newVNode<span class="token punctuation">.</span>key <span class="token operator">===</span> oldVNode<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">15</span>           <span class="token function">patch</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">,</span> newVNode<span class="token punctuation">,</span> container<span class="token punctuation">)</span>
<span class="token number">16</span>           <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> lastIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">17</span>             <span class="token comment">// å¦‚æœå½“å‰æ‰¾åˆ°çš„èŠ‚ç‚¹åœ¨æ—§ children ä¸­çš„ç´¢å¼•å°äºæœ€å¤§ç´¢å¼•å€¼ lastIndexï¼Œ</span>
<span class="token number">18</span>             <span class="token comment">// è¯´æ˜è¯¥èŠ‚ç‚¹å¯¹åº”çš„çœŸå® DOM éœ€è¦ç§»åŠ¨</span>
<span class="token number">19</span>           <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token number">20</span>             <span class="token comment">// å¦‚æœå½“å‰æ‰¾åˆ°çš„èŠ‚ç‚¹åœ¨æ—§ children ä¸­çš„ç´¢å¼•ä¸å°äºæœ€å¤§ç´¢å¼•å€¼ï¼Œ</span>
<span class="token number">21</span>             <span class="token comment">// åˆ™æ›´æ–° lastIndex çš„å€¼</span>
<span class="token number">22</span>             lastIndex <span class="token operator">=</span> j
<span class="token number">23</span>           <span class="token punctuation">}</span>
<span class="token number">24</span>           <span class="token keyword">break</span> <span class="token comment">// è¿™é‡Œéœ€è¦ break</span>
<span class="token number">25</span>         <span class="token punctuation">}</span>
<span class="token number">26</span>       <span class="token punctuation">}</span>
<span class="token number">27</span>     <span class="token punctuation">}</span>
<span class="token number">28</span>
<span class="token number">29</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token number">30</span>     <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">31</span>   <span class="token punctuation">}</span>
<span class="token number">32</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="xG18S"></a></p><h6 id="_9-4-å¦‚ä½•ç§»åŠ¨" tabindex="-1"><a class="header-anchor" href="#_9-4-å¦‚ä½•ç§»åŠ¨" aria-hidden="true">#</a> 9.4ï¼šå¦‚ä½•ç§»åŠ¨</h6><p>è¿™é‡Œçš„ç§»åŠ¨æ˜¯å€¼ç§»åŠ¨çœŸå®<code>DOM</code>ï¼Œè€Œä¸æ˜¯ç§»åŠ¨è™šæ‹Ÿ<code>DOM</code>ã€‚</p><blockquote><p>å¦‚æœç§»åŠ¨çš„æ˜¯vnodeï¼Œé‚£åˆéœ€è¦æŒ‚è½½ï¼Œç­‰äºç™½å¹²</p></blockquote><p><code>vnode.el</code>è®°å½•çš„æ˜¯çœŸå®<code>DOM</code>,æ‰€ä»¥å¯ä»¥åˆ©ç”¨å®ƒæ¥è¿›è¡Œ<code>DOM</code>çš„ç§»åŠ¨ã€‚<br>æ ¹æ®ä¸Šé¢çš„ç®—æ³•æ¥æ¨¡æ‹Ÿä¸€éï¼Œèµ·å§‹çš„ç´¢å¼•æ˜¯0ï¼Œéå†æ–°å­èŠ‚ç‚¹æ•°ç»„ï¼Œå¦‚ä½•åœ¨æ—§å­èŠ‚ç‚¹æ•°ç»„é‡Œç¬¬ä¸€ä¸ªå…ƒç´ <code>p-3</code>å¯å¾—ï¼Œç´¢å¼•ä¸º2ï¼Œæ­¤æ—¶2æ¯”èµ·å§‹ç´¢å¼•å¤§ï¼ˆæœ€å¤§ç´¢å¼•è®°ä¸º<code>lastIndex</code>ï¼‰ï¼Œæ‰€ä»¥<code>p-3</code>ä¸éœ€è¦ç§»åŠ¨ï¼Œå¹¶ä¸”æ›´æ–°<code>lastIndex</code>ä¸º2ã€‚<br>æ¥ç€æ‰¾<code>p-1</code>çš„ç´¢å¼•ï¼Œå€¼ä¸º0ï¼Œæ¯”<code>lastIndex</code>è¦å°ï¼Œè¯´æ˜éœ€è¦ç§»åŠ¨ï¼Œç§»åŠ¨åˆ°ä½•å¤„ï¼Œç”±æ–°å­èŠ‚ç‚¹çš„é¡ºåºè§„å®šï¼Œä¹Ÿå°±æ˜¯ç§»åŠ¨åˆ°<code>newVnode[i - 1]</code>çš„åé¢ã€‚<br>ç„¶åå°±æ˜¯<code>p-2</code>ï¼Œè·Ÿæ‰¾<code>p-1</code>åŒç†ã€‚<br>çœ‹ä»£ç ï¼š</p><ul><li><code>anchor</code>ï¼šé”šç‚¹ï¼Œç”¨äºç§»åŠ¨åˆ°å“ªï¼Œé…åˆ<code>insertBefore</code>ä½¿ç”¨ã€‚</li><li><code>el.nextSibling</code>ï¼šè·å–å…„å¼ŸèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç„¶åèµ‹å€¼ç»™<code>anchor</code>ã€‚</li><li><code>insertBefore</code>ï¼šä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºéœ€è¦æ’å…¥çš„èŠ‚ç‚¹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä½ç½®ã€‚</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token number">01</span> <span class="token keyword">function</span> <span class="token function">patchChildren</span><span class="token punctuation">(</span><span class="token parameter">n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">02</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> n2<span class="token punctuation">.</span>children <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">03</span>     <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">04</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>n2<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">05</span>     <span class="token keyword">const</span> oldChildren <span class="token operator">=</span> n1<span class="token punctuation">.</span>children
<span class="token number">06</span>     <span class="token keyword">const</span> newChildren <span class="token operator">=</span> n2<span class="token punctuation">.</span>children
<span class="token number">07</span>
<span class="token number">08</span>     <span class="token keyword">let</span> lastIndex <span class="token operator">=</span> <span class="token number">0</span>
<span class="token number">09</span>     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> newChildren<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">10</span>       <span class="token keyword">const</span> newVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
<span class="token number">11</span>       <span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span>
<span class="token number">12</span>       <span class="token keyword">for</span> <span class="token punctuation">(</span>j<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> oldChildren<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">13</span>         <span class="token keyword">const</span> oldVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
<span class="token number">14</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span>newVNode<span class="token punctuation">.</span>key <span class="token operator">===</span> oldVNode<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">15</span>           <span class="token function">patch</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">,</span> newVNode<span class="token punctuation">,</span> container<span class="token punctuation">)</span>
<span class="token number">16</span>           <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> lastIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">17</span>             <span class="token comment">// ä»£ç è¿è¡Œåˆ°è¿™é‡Œï¼Œè¯´æ˜ newVNode å¯¹åº”çš„çœŸå® DOM éœ€è¦ç§»åŠ¨</span>
<span class="token number">18</span>             <span class="token comment">// å…ˆè·å– newVNode çš„å‰ä¸€ä¸ª vnodeï¼Œå³ prevVNode</span>
<span class="token number">19</span>             <span class="token keyword">const</span> prevVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
<span class="token number">20</span>             <span class="token comment">// å¦‚æœ prevVNode ä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜å½“å‰ newVNode æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå®ƒä¸éœ€è¦ç§»åŠ¨</span>
<span class="token number">21</span>             <span class="token keyword">if</span> <span class="token punctuation">(</span>prevVNode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">22</span>               <span class="token comment">// ç”±äºæˆ‘ä»¬è¦å°† newVNode å¯¹åº”çš„çœŸå® DOM ç§»åŠ¨åˆ° prevVNode æ‰€å¯¹åº”çœŸå® DOM åé¢ï¼Œ</span>
<span class="token number">23</span>               <span class="token comment">// æ‰€ä»¥æˆ‘ä»¬éœ€è¦è·å– prevVNode æ‰€å¯¹åº”çœŸå® DOM çš„ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹ï¼Œå¹¶å°†å…¶ä½œä¸ºé”šç‚¹</span>
<span class="token number">24</span>               <span class="token keyword">const</span> anchor <span class="token operator">=</span> prevVNode<span class="token punctuation">.</span>el<span class="token punctuation">.</span>nextSibling
<span class="token number">25</span>               <span class="token comment">// è°ƒç”¨ insert æ–¹æ³•å°† newVNode å¯¹åº”çš„çœŸå® DOM æ’å…¥åˆ°é”šç‚¹å…ƒç´ å‰é¢ï¼Œ</span>
<span class="token number">26</span>               <span class="token comment">// ä¹Ÿå°±æ˜¯ prevVNode å¯¹åº”çœŸå® DOM çš„åé¢</span>
<span class="token number">27</span>               <span class="token function">insert</span><span class="token punctuation">(</span>newVNode<span class="token punctuation">.</span>el<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>
<span class="token number">28</span>             <span class="token punctuation">}</span>
<span class="token number">29</span>           <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token number">30</span>             lastIndex <span class="token operator">=</span> j
<span class="token number">31</span>           <span class="token punctuation">}</span>
<span class="token number">32</span>           <span class="token keyword">break</span>
<span class="token number">33</span>         <span class="token punctuation">}</span>
<span class="token number">34</span>       <span class="token punctuation">}</span>
<span class="token number">35</span>     <span class="token punctuation">}</span>
<span class="token number">36</span>
<span class="token number">37</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token number">38</span>     <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">39</span>   <span class="token punctuation">}</span>
<span class="token number">40</span> <span class="token punctuation">}</span>


<span class="token number">01</span> <span class="token keyword">const</span> renderer <span class="token operator">=</span> <span class="token function">createRenderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
<span class="token number">02</span>   <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">03</span>
<span class="token number">04</span>   <span class="token function">insert</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> anchor <span class="token operator">=</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">05</span>     <span class="token comment">// insertBefore éœ€è¦é”šç‚¹å…ƒç´  anchor</span>
<span class="token number">06</span>     parent<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span> <span class="token comment">// å¦‚æœanchorä¸ºnullï¼Œåˆ™ä¼šæ’å…¥åˆ°æœ€åé¢</span>
<span class="token number">07</span>   <span class="token punctuation">}</span>
<span class="token number">08</span>
<span class="token number">09</span>   <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>çœ‹å›¾ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/27119990/1679814510817-acbe6781-1da2-43b6-9a36-29b086cd2b7e.png#averageHue=%23ececec&amp;clientId=uc9d64d88-5777-4&amp;from=paste&amp;height=412&amp;id=Sy78w&amp;originHeight=412&amp;originWidth=672&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=68346&amp;status=done&amp;style=none&amp;taskId=u5c4a942b-6651-4675-9709-b648a1a1619&amp;title=&amp;width=672" alt="image.png" loading="lazy"><br><a name="Rrvlq"></a></p><h6 id="_9-5-æ·»åŠ æ–°å…ƒç´ " tabindex="-1"><a class="header-anchor" href="#_9-5-æ·»åŠ æ–°å…ƒç´ " aria-hidden="true">#</a> 9.5ï¼šæ·»åŠ æ–°å…ƒç´ </h6><p>æ–°å¢èŠ‚ç‚¹è€ƒè™‘çš„é—®é¢˜å¦‚ä¸‹ï¼š</p><ul><li>å“ªä¸ªéœ€è¦æ–°å¢</li><li>æ–°å¢çš„è¯¥æ”¾å“ª</li></ul><p>é—®é¢˜ä¸€åœ¨å‰é¢è®¾ç½®<code>key</code>çš„æ—¶å€™å°±å·²ç»è§£å†³äº†ï¼Œå¦‚æœæ–°å­èŠ‚ç‚¹æ•°ç»„å†…æœ‰çš„è€Œæ—§çš„æ²¡æœ‰çš„è¯ï¼Œè¯´æ˜æ˜¯æ–°å¢ã€‚<br>é—®é¢˜äºŒå…¶å®ä¹Ÿç®€å•ï¼Œå› ä¸ºåœ¨æ–°å­èŠ‚ç‚¹æ•°ç»„é‡Œæ˜¯è§„å®šå¥½äº†é¡ºåºï¼Œå¹¶ä¸”ä¹Ÿè·Ÿå¯¹åº”çš„çœŸå®<code>DOM</code>æœ‰è”ç³»ï¼Œæ‰€ä»¥ç›´æ¥æŒ‚è½½å°±å¯ä»¥äº†ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token number">01</span> <span class="token keyword">function</span> <span class="token function">patchChildren</span><span class="token punctuation">(</span><span class="token parameter">n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">02</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> n2<span class="token punctuation">.</span>children <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">03</span>     <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">04</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>n2<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">05</span>     <span class="token keyword">const</span> oldChildren <span class="token operator">=</span> n1<span class="token punctuation">.</span>children
<span class="token number">06</span>     <span class="token keyword">const</span> newChildren <span class="token operator">=</span> n2<span class="token punctuation">.</span>children
<span class="token number">07</span>
<span class="token number">08</span>     <span class="token keyword">let</span> lastIndex <span class="token operator">=</span> <span class="token number">0</span>
<span class="token number">09</span>     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> newChildren<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">10</span>       <span class="token keyword">const</span> newVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
<span class="token number">11</span>       <span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span>
<span class="token number">12</span>       <span class="token comment">// åœ¨ç¬¬ä¸€å±‚å¾ªç¯ä¸­å®šä¹‰å˜é‡ findï¼Œä»£è¡¨æ˜¯å¦åœ¨æ—§çš„ä¸€ç»„å­èŠ‚ç‚¹ä¸­æ‰¾åˆ°å¯å¤ç”¨çš„èŠ‚ç‚¹ï¼Œ</span>
<span class="token number">13</span>       <span class="token comment">// åˆå§‹å€¼ä¸º falseï¼Œä»£è¡¨æ²¡æ‰¾åˆ°</span>
<span class="token number">14</span>       <span class="token keyword">let</span> find <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token number">15</span>       <span class="token keyword">for</span> <span class="token punctuation">(</span>j<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> oldChildren<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">16</span>         <span class="token keyword">const</span> oldVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
<span class="token number">17</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span>newVNode<span class="token punctuation">.</span>key <span class="token operator">===</span> oldVNode<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">18</span>           <span class="token comment">// ä¸€æ—¦æ‰¾åˆ°å¯å¤ç”¨çš„èŠ‚ç‚¹ï¼Œåˆ™å°†å˜é‡ find çš„å€¼è®¾ä¸º true</span>
<span class="token number">19</span>           find <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token number">20</span>           <span class="token function">patch</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">,</span> newVNode<span class="token punctuation">,</span> container<span class="token punctuation">)</span>
<span class="token number">21</span>           <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> lastIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">22</span>             <span class="token keyword">const</span> prevVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
<span class="token number">23</span>             <span class="token keyword">if</span> <span class="token punctuation">(</span>prevVNode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">24</span>               <span class="token keyword">const</span> anchor <span class="token operator">=</span> prevVNode<span class="token punctuation">.</span>el<span class="token punctuation">.</span>nextSibling
<span class="token number">25</span>               <span class="token function">insert</span><span class="token punctuation">(</span>newVNode<span class="token punctuation">.</span>el<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>
<span class="token number">26</span>             <span class="token punctuation">}</span>
<span class="token number">27</span>           <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token number">28</span>             lastIndex <span class="token operator">=</span> j
<span class="token number">29</span>           <span class="token punctuation">}</span>
<span class="token number">30</span>           <span class="token keyword">break</span>
<span class="token number">31</span>         <span class="token punctuation">}</span>
<span class="token number">32</span>       <span class="token punctuation">}</span>
<span class="token number">33</span>       <span class="token comment">// å¦‚æœä»£ç è¿è¡Œåˆ°è¿™é‡Œï¼Œfind ä»ç„¶ä¸º falseï¼Œ</span>
<span class="token number">34</span>       <span class="token comment">// è¯´æ˜å½“å‰ newVNode æ²¡æœ‰åœ¨æ—§çš„ä¸€ç»„å­èŠ‚ç‚¹ä¸­æ‰¾åˆ°å¯å¤ç”¨çš„èŠ‚ç‚¹</span>
<span class="token number">35</span>       <span class="token comment">// ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å‰ newVNode æ˜¯æ–°å¢èŠ‚ç‚¹ï¼Œéœ€è¦æŒ‚è½½</span>
<span class="token number">36</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>find<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">37</span>         <span class="token comment">// ä¸ºäº†å°†èŠ‚ç‚¹æŒ‚è½½åˆ°æ­£ç¡®ä½ç½®ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè·å–é”šç‚¹å…ƒç´ </span>
<span class="token number">38</span>         <span class="token comment">// é¦–å…ˆè·å–å½“å‰ newVNode çš„å‰ä¸€ä¸ª vnode èŠ‚ç‚¹</span>
<span class="token number">39</span>         <span class="token keyword">const</span> prevVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
<span class="token number">40</span>         <span class="token keyword">let</span> anchor <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token number">41</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span>prevVNode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">42</span>           <span class="token comment">// å¦‚æœæœ‰å‰ä¸€ä¸ª vnode èŠ‚ç‚¹ï¼Œåˆ™ä½¿ç”¨å®ƒçš„ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹ä½œä¸ºé”šç‚¹å…ƒç´ </span>
<span class="token number">43</span>           anchor <span class="token operator">=</span> prevVNode<span class="token punctuation">.</span>el<span class="token punctuation">.</span>nextSibling
<span class="token number">44</span>         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token number">45</span>           <span class="token comment">// å¦‚æœæ²¡æœ‰å‰ä¸€ä¸ª vnode èŠ‚ç‚¹ï¼Œè¯´æ˜å³å°†æŒ‚è½½çš„æ–°èŠ‚ç‚¹æ˜¯ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹</span>
<span class="token number">46</span>           <span class="token comment">// è¿™æ—¶æˆ‘ä»¬ä½¿ç”¨å®¹å™¨å…ƒç´ çš„ firstChild ä½œä¸ºé”šç‚¹</span>
<span class="token number">47</span>           anchor <span class="token operator">=</span> container<span class="token punctuation">.</span>firstChild
<span class="token number">48</span>         <span class="token punctuation">}</span>
<span class="token number">49</span>         <span class="token comment">// æŒ‚è½½ newVNode</span>
<span class="token number">50</span>         <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> newVNode<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>
<span class="token number">51</span>       <span class="token punctuation">}</span>
<span class="token number">52</span>     <span class="token punctuation">}</span>
<span class="token number">53</span>
<span class="token number">54</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token number">55</span>     <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">56</span>   <span class="token punctuation">}</span>
<span class="token number">57</span> <span class="token punctuation">}</span>


<span class="token number">01</span> <span class="token comment">// patch å‡½æ•°éœ€è¦æ¥æ”¶ç¬¬å››ä¸ªå‚æ•°ï¼Œå³é”šç‚¹å…ƒç´ </span>
<span class="token number">02</span> <span class="token keyword">function</span> <span class="token function">patch</span><span class="token punctuation">(</span><span class="token parameter">n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">03</span>   <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">04</span>
<span class="token number">05</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> type <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">06</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>n1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">07</span>       <span class="token comment">// æŒ‚è½½æ—¶å°†é”šç‚¹å…ƒç´ ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ä¼ é€’ç»™ mountElement å‡½æ•°</span>
<span class="token number">08</span>       <span class="token function">mountElement</span><span class="token punctuation">(</span>n2<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>
<span class="token number">09</span>     <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token number">10</span>       <span class="token function">patchElement</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span>
<span class="token number">11</span>     <span class="token punctuation">}</span>
<span class="token number">12</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> Text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">13</span>     <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">14</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> Fragment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">15</span>     <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">16</span>   <span class="token punctuation">}</span>
<span class="token number">17</span> <span class="token punctuation">}</span>
<span class="token number">18</span>
<span class="token number">19</span> <span class="token comment">// mountElement å‡½æ•°éœ€è¦å¢åŠ ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå³é”šç‚¹å…ƒç´ </span>
<span class="token number">20</span> <span class="token keyword">function</span> <span class="token function">mountElement</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">21</span>   <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">22</span>
<span class="token number">23</span>   <span class="token comment">// åœ¨æ’å…¥èŠ‚ç‚¹æ—¶ï¼Œå°†é”šç‚¹å…ƒç´ é€ä¼ ç»™ insert å‡½æ•°</span>
<span class="token number">24</span>   <span class="token function">insert</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>
<span class="token number">25</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="F71R4"></a></p><h6 id="_9-6-ç§»é™¤ä¸å­˜åœ¨çš„å…ƒç´ " tabindex="-1"><a class="header-anchor" href="#_9-6-ç§»é™¤ä¸å­˜åœ¨çš„å…ƒç´ " aria-hidden="true">#</a> 9.6ï¼šç§»é™¤ä¸å­˜åœ¨çš„å…ƒç´ </h6><p>éå†æ—§å­æ•°ç»„ï¼Œå¦‚æœæ—§çš„æœ‰è€Œæ–°çš„æ²¡æœ‰è¯´æ˜è¦ç§»é™¤ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token number">01</span> <span class="token keyword">function</span> <span class="token function">patchChildren</span><span class="token punctuation">(</span><span class="token parameter">n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">02</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> n2<span class="token punctuation">.</span>children <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">03</span>     <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">04</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>n2<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">05</span>     <span class="token keyword">const</span> oldChildren <span class="token operator">=</span> n1<span class="token punctuation">.</span>children
<span class="token number">06</span>     <span class="token keyword">const</span> newChildren <span class="token operator">=</span> n2<span class="token punctuation">.</span>children
<span class="token number">07</span>
<span class="token number">08</span>     <span class="token keyword">let</span> lastIndex <span class="token operator">=</span> <span class="token number">0</span>
<span class="token number">09</span>     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> newChildren<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">10</span>       <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">11</span>     <span class="token punctuation">}</span>
<span class="token number">12</span>
<span class="token number">13</span>     <span class="token comment">// ä¸Šä¸€æ­¥çš„æ›´æ–°æ“ä½œå®Œæˆå</span>
<span class="token number">14</span>     <span class="token comment">// éå†æ—§çš„ä¸€ç»„å­èŠ‚ç‚¹</span>
<span class="token number">15</span>     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> oldChildren<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">16</span>       <span class="token keyword">const</span> oldVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
<span class="token number">17</span>       <span class="token comment">// æ‹¿æ—§å­èŠ‚ç‚¹ oldVNode å»æ–°çš„ä¸€ç»„å­èŠ‚ç‚¹ä¸­å¯»æ‰¾å…·æœ‰ç›¸åŒ key å€¼çš„èŠ‚ç‚¹</span>
<span class="token number">18</span>       <span class="token keyword">const</span> has <span class="token operator">=</span> newChildren<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
<span class="token number">19</span>         <span class="token parameter">vnode</span> <span class="token operator">=&gt;</span> vnode<span class="token punctuation">.</span>key <span class="token operator">===</span> oldVNode<span class="token punctuation">.</span>key
<span class="token number">20</span>       <span class="token punctuation">)</span>
<span class="token number">21</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>has<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">22</span>         <span class="token comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°å…·æœ‰ç›¸åŒ key å€¼çš„èŠ‚ç‚¹ï¼Œåˆ™è¯´æ˜éœ€è¦åˆ é™¤è¯¥èŠ‚ç‚¹</span>
<span class="token number">23</span>         <span class="token comment">// è°ƒç”¨ unmount å‡½æ•°å°†å…¶å¸è½½</span>
<span class="token number">24</span>         <span class="token function">unmount</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">)</span>
<span class="token number">25</span>       <span class="token punctuation">}</span>
<span class="token number">26</span>     <span class="token punctuation">}</span>
<span class="token number">27</span>
<span class="token number">28</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token number">29</span>     <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">30</span>   <span class="token punctuation">}</span>
<span class="token number">31</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="AQudu"></a></p><h6 id="_9-7-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_9-7-æ€»ç»“" aria-hidden="true">#</a> 9.7ï¼šæ€»ç»“</h6><p><code>Diff</code>ç®—æ³•æ˜¯ç”¨æ¥è®¡ç®—ä¸¤ç»„å­èŠ‚ç‚¹çš„å·®å¼‚ï¼Œå¹¶ä¸”æœ€å¤§ç¨‹åº¦ä¸Šæ¥å¤ç”¨<code>DOM</code>å…ƒç´ ã€‚æ”¹è¿›å‰æ˜¯å…¨éƒ¨å¸è½½å†æŒ‚è½½ï¼Œæ”¹è¿›åæ˜¯éå†æ–°æ—§å­èŠ‚ç‚¹æ•°é‡ï¼Œéœ€è¦æ›´æ–°çš„æ›´æ–°ï¼Œéœ€è¦å¸è½½çš„å¸è½½ï¼Œéœ€è¦å¢åŠ çš„å¢åŠ ã€‚å…¶ä¸­å¼•å…¥äº†<code>key</code>ï¼Œæ˜¯<code>Diff</code>ç®—æ³•é‡Œä¸€ä¸ªéå¸¸é‡è¦çš„è§’è‰²ã€‚<br>ç„¶åè¿˜è®²äº†å¦‚ä½•ç§»åŠ¨æ·»åŠ åˆ é™¤ç­‰ç­‰ã€‚<br><a name="pQjfQ"></a></p><h5 id="vueè®¾è®¡ä¸å®ç°ç¬¬åç« -åŒç«¯diffç®—æ³•" tabindex="-1"><a class="header-anchor" href="#vueè®¾è®¡ä¸å®ç°ç¬¬åç« -åŒç«¯diffç®—æ³•" aria-hidden="true">#</a> vueè®¾è®¡ä¸å®ç°ç¬¬åç« ï¼šåŒç«¯Diffç®—æ³•</h5><p><a name="ZY39g"></a></p><h6 id="_10-1-åŒç«¯æ¯”è¾ƒçš„åŸç†" tabindex="-1"><a class="header-anchor" href="#_10-1-åŒç«¯æ¯”è¾ƒçš„åŸç†" aria-hidden="true">#</a> 10.1ï¼šåŒç«¯æ¯”è¾ƒçš„åŸç†</h6><p>ç®€å•<code>Diff</code>ç®—æ³•æ‰§è¡Œæµç¨‹ï¼š<br>éå†<code>newChildren</code>ï¼Œåœ¨<code>oldChildren</code> é‡Œæ‰¾<code>newChildren[i]</code>çš„ç´¢å¼•ï¼Œå¹¶ä¸”ç»´æŠ¤ä¸€ä¸ª<code>lastIndex</code>è®°å½•æœ€å¤§ç´¢å¼•</p><ul><li>å¦‚æœ<code>i &lt; lastIndex</code>åˆ™å°†<code>newChildren[i]</code>çš„çœŸå®<code>Dom</code>ç§»åŠ¨åˆ°<code>newChildren[i - 1]</code>ä¸‹é¢ï¼Œ</li><li>å¦åˆ™ä¸åŠ¨ï¼Œå¹¶ä¸”æ›´æ–°<code>lastIndex</code></li></ul><p>ç¼ºç‚¹ï¼šå¦‚å›¾æ‰€ç¤ºï¼Œå¯¹äºæ–°æ—§<code>vnode</code>å»æ“ä½œ<code>Dom</code>çš„æ—¶å€™ï¼Œä»–æ˜¯å°†<code>p-1</code>ï¼Œ<code>p-2</code>å¾€ä¸‹ç§»ã€‚è¿›è¡Œäº†ä¸¤æ¬¡æ“ä½œï¼Œå‡è®¾å¦‚æœ<code>oldVnode</code>æ˜¯ä»<code>p1-pn</code>,è€Œ<code>newVnode</code>çš„é¡ºåºæ˜¯<code>pn,p1-pn-1</code>,ä»¥ç®€å•<code>Diff</code>ç®—æ³•æ¥è¯´ï¼Œä»–æ˜¯ä¸æ˜¯ä¼šè¿›è¡Œæ“ä½œ<code>n-1</code>æ­¤<code>Dom</code>çš„ç§»åŠ¨ï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œåªéœ€è¦å°†<code>pn</code>ç§»åŠ¨åˆ°æœ€ä¸‹é¢ï¼Œå°±èƒ½å®Œæˆæ“ä½œã€‚è¿™å°±æ˜¯åŒç«¯<code>Diff</code>ç®—æ³• ä¼˜åŒ–çš„ä¸€ä¸ªæ–¹å‘ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/27119990/1680918674558-39498fb1-928d-48bd-944e-f21029437c61.png#averageHue=%23f0f0f0&amp;clientId=uea9ba219-d8a1-4&amp;from=paste&amp;height=239&amp;id=u2e74a3d8&amp;originHeight=340&amp;originWidth=390&amp;originalType=binary&amp;ratio=0.8999999761581421&amp;rotation=0&amp;showTitle=false&amp;size=52730&amp;status=done&amp;style=none&amp;taskId=u4ba42473-672d-4b14-aca9-d6319ce3a3f&amp;title=&amp;width=274.31597900390625" alt="image.png" loading="lazy"><img src="https://cdn.nlark.com/yuque/0/2023/png/27119990/1680918706069-83b7d8fa-c62e-4f8f-8cd2-06ae8e39516d.png#averageHue=%23efefef&amp;clientId=uea9ba219-d8a1-4&amp;from=paste&amp;height=242&amp;id=u255d7fa8&amp;originHeight=290&amp;originWidth=392&amp;originalType=binary&amp;ratio=0.8999999761581421&amp;rotation=0&amp;showTitle=false&amp;size=40267&amp;status=done&amp;style=none&amp;taskId=u1806a264-07ca-4582-989e-de62729c8a1&amp;title=&amp;width=326.5486145019531" alt="image.png" loading="lazy"><br>åŒç«¯<code>Diff</code>ç®—æ³•æ‰§è¡Œæµç¨‹ï¼š<br>ä¸Šé¢æ˜¯è¯¥ç®—æ³•çš„å˜é‡ï¼Œä¸‹é¢æ˜¯è¯¥ç®—æ³•æ¯æ¬¡éƒ½è¦æ‰§è¡Œçš„å››æ­¥</p><ul><li>ç¬¬ä¸€æ­¥æ¯”è¾ƒæ–°æ—§èŠ‚ç‚¹çš„<code>startVnode</code>ï¼šå¯¹åº”<code>index</code>å¾€ä¸‹èµ°</li><li>ç¬¬äºŒæ­¥æ¯”è¾ƒæ–°æ—§èŠ‚ç‚¹çš„<code>endVnode</code>ï¼šå¯¹åº”<code>index</code>å¾€ä¸Šèµ°</li><li>ç¬¬ä¸‰æ­¥æ¯”è¾ƒ<code>newStartVnode</code>å’Œ<code>oldEndVnode</code>ï¼šæ–°çš„å¾€ä¸‹èµ°ï¼Œæ—§çš„å¾€ä¸Šèµ°ï¼Œå¹¶ä¸”æŠŠ<code>oldEndVnode</code>æ’å…¥åˆ°<code>oldStartVnode</code>çš„ä¸Šé¢</li><li>ç¬¬å››æ­¥æ¯”è¾ƒ<code>newEndVnode</code>å’Œ<code>oldStartVnode</code>ï¼šæ–°çš„å¾€ä¸Šèµ°ï¼Œæ—§çš„å¾€ä¸‹èµ°ï¼Œå¹¶ä¸”æŠŠ<code>oldStartVnode</code>æ’å…¥åˆ°<code>oldEndVnode</code>çš„ä¸‹é¢</li></ul><p>é€šè¿‡æ¯”è¾ƒ<code>key</code>å€¼ï¼Œåˆ¤æ–­ä»–ä»¬æ˜¯å¦å¯å¤ç”¨ï¼Œå¦‚æœå¯å¤ç”¨ï¼Œåˆ™èµ°å¯¹åº”åˆ†æ”¯ï¼Œå¹¶ä¸”æ›´æ–°å¯¹åº”çš„<code>index</code>ã€‚</p><blockquote><p>å¯¹äºæ¯ä¸€ä¸ªåˆ†æ”¯ï¼Œç¬¬ä¸€æ­¥éƒ½éœ€è¦patch</p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2023/png/27119990/1680922246786-f8c1107e-beb0-4f41-9827-e605f10ac462.png#averageHue=%23eeeeee&amp;clientId=u16e9008d-eec3-4&amp;from=paste&amp;height=255&amp;id=u1d0fb722&amp;originHeight=191&amp;originWidth=420&amp;originalType=binary&amp;ratio=0.8999999761581421&amp;rotation=0&amp;showTitle=false&amp;size=23009&amp;status=done&amp;style=none&amp;taskId=uaa172edb-3449-4c90-838c-5e4ca60ec8b&amp;title=&amp;width=560" alt="image.png" loading="lazy"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/27119990/1680922257749-106dc6f5-36fc-452a-b1cb-78ce400960c0.png#averageHue=%23f2f2f2&amp;clientId=u16e9008d-eec3-4&amp;from=paste&amp;height=271&amp;id=uebdb72ca&amp;originHeight=203&amp;originWidth=403&amp;originalType=binary&amp;ratio=0.8999999761581421&amp;rotation=0&amp;showTitle=false&amp;size=24085&amp;status=done&amp;style=none&amp;taskId=ubaea680b-b676-421b-a042-87d3663f6f3&amp;title=&amp;width=537.3333333333334" alt="image.png" loading="lazy"><br>ä¸Šé¢æ˜¯ç†æƒ³çŠ¶æ€ä¸‹çš„åŒç«¯<code>Diff</code>ç®—æ³•æ¯”è¾ƒï¼Œä»–èƒ½è·‘èµ·æ¥çš„å‰ææ˜¯ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªåˆ†æ”¯èƒ½èµ°ï¼Œä½†æ˜¯æœ‰æ—¶å€™ä¼šå‡ºç°ï¼ŒåŒç«¯ï¼Œéƒ½èµ°ä¸äº†çš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä»–å°±ä¼šèµ°ç¬¬äº”æ­¥ã€‚</p><ul><li>ç¬¬äº”æ­¥ï¼Œæ‹¿<code>newStartVnode</code>åœ¨æ—§çš„é‡Œé¢æ‰¾ï¼Œæ‰¾åˆ°æ‰€åœ¨çš„ä½ç½®ï¼Œå¹¶ä¸”è®°å½•ä¸º<code>oldToVnode</code>ï¼Œå¹¶ä¸”å°†è¿™ä¸ª<code>oldToVnode</code>ç§»åŠ¨åˆ°<code>oldStartVnode</code>çš„ä¸Šé¢ã€‚</li></ul><blockquote><p>è¿™é‡Œæš‚ä¸è€ƒè™‘æ²¡æ‰¾åˆ°çš„æƒ…å†µï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°±æ„å‘³ç€æ–°å¢äº†</p></blockquote><p>æ­¤æ—¶ï¼Œå°±å°†<code>newStartVode</code>çš„ä½ç½®æ’å¥½äº†ï¼Œåœ¨è€Œ<code>oldToVnode</code>çš„ä½ç½®çš„<code>Vnode</code>æ˜¯å·²ç»èµ°è¿‡äº†çš„ï¼Œé¿å…ä¸‹ä¸€æ¬¡å¾ªç¯å†èµ°ï¼Œæ‰€ä»¥æŠŠå®ƒç½®ä¸º<code>undefined</code>ï¼Œä¸‹ä¸€è½®å˜é‡çš„æ—¶å€™ï¼Œåœ¨åŠ ä¸ªå¯¹<code>oldStartVnode</code>åšä¸€ä¸‹ç‰¹æ®Šå¤„ç†ï¼Œå€¼æ˜¯<code>undefined</code>ç›´æ¥è·³è¿‡å°±å¥½äº†ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/27119990/1680923258397-c52a2c5f-f28b-4b8e-afbe-5021847f428c.png#averageHue=%23ebebeb&amp;clientId=u16e9008d-eec3-4&amp;from=paste&amp;height=369&amp;id=OkQG2&amp;originHeight=277&amp;originWidth=607&amp;originalType=binary&amp;ratio=0.8999999761581421&amp;rotation=0&amp;showTitle=false&amp;size=42586&amp;status=done&amp;style=none&amp;taskId=u64a76d3b-d6ff-4187-b2bd-7079c69bcdc&amp;title=&amp;width=809.3333333333334" alt="image.png" loading="lazy"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/27119990/1680923861027-e5f32aea-f0d8-49d1-af0c-f049d210e8b4.png#averageHue=%23ededed&amp;clientId=u16e9008d-eec3-4&amp;from=paste&amp;height=375&amp;id=u6ae871e9&amp;originHeight=281&amp;originWidth=611&amp;originalType=binary&amp;ratio=0.8999999761581421&amp;rotation=0&amp;showTitle=false&amp;size=46302&amp;status=done&amp;style=none&amp;taskId=u24f7425a-59ba-40aa-8e35-0dbdb39e0ca&amp;title=&amp;width=814.6666666666666" alt="image.png" loading="lazy"><br><a name="lrSdt"></a></p><h6 id="_10-2-æ·»åŠ æ–°å…ƒç´ " tabindex="-1"><a class="header-anchor" href="#_10-2-æ·»åŠ æ–°å…ƒç´ " aria-hidden="true">#</a> 10.2ï¼šæ·»åŠ æ–°å…ƒç´ </h6><p>å¯¹äºåŒç«¯<code>Diff</code>ç®—æ³•çš„åŸç†ï¼Œä¸Šé¢åˆ†æäº†è¯¥ç®—æ³•å¦‚ä½•æ‰§è¡Œï¼Œåˆ†æäº†åœ¨ç†æƒ³çŠ¶æ€å’Œéç†æƒ³çŠ¶æ€çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯å¯¹äºå¤´å’Œå°¾èƒ½ä¸èƒ½æ‰¾åˆ°å¯¹åº”çš„å¹¶ä¸”ç§»åŠ¨çš„æƒ…å†µã€‚<br>åœ¨éç†æƒ³çŠ¶æ€ä¸‹ï¼Œæ–°æ—§å­æ•°ç»„ä¸èƒ½ä¿è¯ä»–èƒ½ç›´æ¥æ‰¾åˆ°ï¼Œæ–°å¢åˆ†æ”¯5ç”¨æ¥åšç‰¹æ®Šå¤„ç†ï¼Œä»¥åŠæ–°å¢ç‰¹æ®Šåˆ¤æ–­ï¼Œåˆ¤æ–­è¯¥<code>Vnode</code>æ˜¯å¦å·²ç»ç§»åŠ¨è¿‡äº†ã€‚<br>ä½†æ˜¯å¯¹äºéç†æ€§çŠ¶æ€ï¼Œä¹Ÿå¹¶ä¸æ˜¯æ€»èƒ½æ‰¾åˆ°ï¼Œè¿™ç§æƒ…å†µï¼Œå°±å±äºæ–°å¢èŠ‚ç‚¹ã€‚</p><blockquote><p>ç™½è¯ï¼šæˆ‘æ–°æ•°ç»„é‡Œæœ‰ï¼Œä½ æ—§çš„æ²¡æœ‰ï¼Œæ‰€ä»¥æ–°å¢</p></blockquote><p>é€»è¾‘è¿˜æ˜¯æŒºç®€å•çš„ï¼Œå°±æ˜¯åœ¨åˆ†æ”¯5ä¸­åŠ ä¸ªåˆ¤æ–­ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°é‡å¤çš„<code>key</code>é‚£å°±å°†<code>newStartVnoe</code>æ’å…¥åˆ°<code>oldStartVnode</code>çš„ä¸Šé¢å³å¯ã€‚<br>ä½†æ˜¯è¿™è¿˜æœ‰ç¼ºé™·ï¼Œçœ‹ä¾‹å­ï¼š</p><ul><li><code>newChildren</code>ï¼š4ï¼Œ1ï¼Œ2ï¼Œ3</li><li><code>oldChildren</code>ï¼š1ï¼Œ2ï¼Œ3</li></ul><p>ä»–ä»¬å¼€å§‹è·‘ä»£ç ï¼Œä¼šå‘ç°å°¾éƒ¨ä¸€ç›´ç›¸åŒï¼Œé‚£ä¹ˆå°±ä¸€ç›´ä¼šèµ°åˆ†æ”¯2ï¼Œç„¶åä¸€ç›´è·³è¿‡ï¼Œç„¶å<code>oldEndIndex</code>ä¼šå˜æˆ<code>-1</code>ï¼Œ<code>oldStartIndex</code>è¿˜æ˜¯<code>1</code>ï¼Œå¾ªç¯ç»“æŸã€‚ä½†æ˜¯å¯¹äº<code>newChildren</code>çš„<code>4</code>ï¼Œä»–å¹¶æ²¡æœ‰åšä»»ä½•æ“ä½œï¼Œè¢«é—å¼ƒäº†ã€‚<br>æ‰€ä»¥ï¼Œè¿˜éœ€è¦åœ¨åˆ†æ”¯5åŠ ä¸ªåˆ¤æ–­ï¼Œåˆ¤æ–­<code>newChildren</code>æ˜¯å¦æœ‰é—ç•™ï¼Œä¹Ÿå°±æ˜¯<code>newStartIndex &lt;= newEndIndex &amp;&amp; oldStartIndex &gt; oldEndIndex</code>ï¼Œè¿™æ—¶å€™éœ€è¦å°†<code>newStartIndex</code>åˆ°<code>newEndIndex</code>ä¹‹é—´çš„æ‰€æœ‰ç»“ç‚¹æŒ‚è½½åˆ°å¤´éƒ¨ã€‚<br><a name="bWKDQ"></a></p><h6 id="_10-3-ç§»é™¤æ—§èŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#_10-3-ç§»é™¤æ—§èŠ‚ç‚¹" aria-hidden="true">#</a> 10.3ï¼šç§»é™¤æ—§èŠ‚ç‚¹</h6><p>åˆ¤æ–­æ–°å¢æ˜¯é€šè¿‡åˆ¤æ–­<code>oldEnd</code>æ˜¯å¦å°äº<code>oldStart</code>å¹¶ä¸”æ»¡è¶³<code>newStart</code>è¦å°äºç­‰äº<code>newEnd</code>ï¼Œè€Œåˆ¤æ–­ç§»é™¤ä¹Ÿå·®ä¸å¤šï¼Œå°±æ˜¯åˆ¤æ–­<code>newEnd</code>æ˜¯å¦å°äº<code>newStart</code>å¹¶ä¸”æ»¡è¶³<code>oldStart</code>è¦å°äºç­‰äº<code>oldEnd</code>ï¼Œæ»¡è¶³æ¡ä»¶å°±é€ä¸ª<code>unmount</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token number">01</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>oldStartIdx <span class="token operator">&lt;=</span> oldEndIdx <span class="token operator">&amp;&amp;</span> newStartIdx <span class="token operator">&lt;=</span> newEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">02</span>   <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç  ç§»åŠ¨èŠ‚ç‚¹äº”ä¸ªåˆ†æ”¯</span>
<span class="token number">03</span> <span class="token punctuation">}</span>
<span class="token number">04</span>
<span class="token number">05</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldEndIdx <span class="token operator">&lt;</span> oldStartIdx <span class="token operator">&amp;&amp;</span> newStartIdx <span class="token operator">&lt;=</span> newEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">06</span>   <span class="token comment">// æ·»åŠ æ–°èŠ‚ç‚¹</span>
<span class="token number">07</span>   <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token number">08</span> <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>newEndIdx <span class="token operator">&lt;</span> newStartIdx <span class="token operator">&amp;&amp;</span> oldStartIdx <span class="token operator">&lt;=</span> oldEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">09</span>   <span class="token comment">// ç§»é™¤æ“ä½œ</span>
<span class="token number">10</span>   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> oldStartIdx<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> oldEndIdx<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">11</span>     <span class="token function">unmount</span><span class="token punctuation">(</span>oldChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token number">12</span>   <span class="token punctuation">}</span>
<span class="token number">13</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="HFIWM"></a></p><h5 id="vueè®¾è®¡ä¸å®ç°ç¬¬åä¸€ç« -å¿«é€Ÿdiffç®—æ³•" tabindex="-1"><a class="header-anchor" href="#vueè®¾è®¡ä¸å®ç°ç¬¬åä¸€ç« -å¿«é€Ÿdiffç®—æ³•" aria-hidden="true">#</a> vueè®¾è®¡ä¸å®ç°ç¬¬åä¸€ç« ï¼šå¿«é€ŸDiffç®—æ³•</h5><p><a name="KyzDc"></a></p><h6 id="_11-1-ç›¸åŒå‰ç½®å’Œåç½®å…ƒç´ " tabindex="-1"><a class="header-anchor" href="#_11-1-ç›¸åŒå‰ç½®å’Œåç½®å…ƒç´ " aria-hidden="true">#</a> 11.1ï¼šç›¸åŒå‰ç½®å’Œåç½®å…ƒç´ </h6><p>å¿«é€Ÿ<code>Diff</code>ç®—æ³•ä¸å‰ä¸¤ä¸ª<code>Diff</code>ç®—æ³•çš„åŒºåˆ«å°±æ˜¯å®ƒå…·æœ‰ä¸€ä¸ªé¢„å¤„ç†çš„è¿‡ç¨‹ã€‚<br>ä½•ä¸ºé¢„å¤„ç†ï¼Ÿæœ¬è´¨ä¸Šæ¥è®²å°±æ˜¯ï¼Œæ™’æ‰ç›¸åŒçš„ï¼Œç•™ä¸‹ä¸åŒçš„ï¼Œæˆ‘åªéœ€è¦å»ç®¡ç†ä¸åŒçš„éƒ¨åˆ†ï¼Œå¹¶ä¸”å¯¹è¯¥éƒ¨åˆ†è¿›è¡Œcrudæ“ä½œã€‚<br>çœ‹è¿™è¾¹ä¾‹å­ï¼š</p><div class="language-latex line-numbers-mode" data-ext="latex"><pre class="language-latex"><code>01 TEXT1: I use vue for app development
02 TEXT2: I use react for app development
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸¤æ®µæ–‡æœ¬ï¼Œä»”ç»†å‘ç°å…¶å®åªæœ‰<code>vue</code>å’Œ<code>react</code>ä¸ä¸€æ ·ï¼Œå‰åéƒ½ä¸€æ ·ã€‚é‚£ä¹ˆè¿™è¯´æ˜ï¼ŒçœŸæ­£éœ€è¦æ“ä½œçš„å…¶å®åªæœ‰è¿™ä¸¤ä¸ªã€‚</p><div class="language-latex line-numbers-mode" data-ext="latex"><pre class="language-latex"><code>01 TEXT1: I like you
02 TEXT2: I like you too
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä¹Ÿä¸€æ ·ï¼Œåªéœ€è¦å¤„ç†åé¢å³å¯ã€‚<br>å¦‚æœå¼•ç”³åˆ°<code>vnode</code>ä¸Šï¼Œçœ‹å¦‚ä¸‹çš„å›¾ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2023/png/27119990/1681519758941-c65b946c-0830-4adf-a7d7-02993c6ae6f9.png#averageHue=%23ececec&amp;clientId=u26280add-9a06-4&amp;from=paste&amp;height=613&amp;id=u43cbf890&amp;originHeight=552&amp;originWidth=462&amp;originalType=binary&amp;ratio=0.8999999761581421&amp;rotation=0&amp;showTitle=false&amp;size=56020&amp;status=done&amp;style=none&amp;taskId=ude6c4498-9b8e-4274-8b9c-0ba9c067ab6&amp;title=&amp;width=513.333346932023" alt="image.png" loading="lazy"><br>å¯¹äºç›¸åŒçš„ï¼Œæˆ‘ä»¬å®Œå…¨ä¸éœ€è¦å»å¤„ç†å®ƒï¼Œåªéœ€æ‰¾åˆ°ä¸åŒå³å¯ã€‚<br>ä»£ç ä¹Ÿç®€å•ï¼Œå¼€ä¸¤ä¸ª<code>while</code>å¾ªç¯ï¼Œç„¶åä»é¡¶éƒ¨å’Œåº•éƒ¨éå†æ‰è¿™äº›ç›¸åŒèŠ‚ç‚¹ï¼Œå°†ç´¢å¼•å»æŒ‡å‘éœ€è¦<code>Diff</code>çš„åŒºåŸŸå³å¯ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token number">01</span> <span class="token keyword">function</span> <span class="token function">patchKeyedChildren</span><span class="token punctuation">(</span><span class="token parameter">n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">02</span>   <span class="token keyword">const</span> newChildren <span class="token operator">=</span> n2<span class="token punctuation">.</span>children
<span class="token number">03</span>   <span class="token keyword">const</span> oldChildren <span class="token operator">=</span> n1<span class="token punctuation">.</span>children
<span class="token number">04</span>   <span class="token comment">// æ›´æ–°ç›¸åŒçš„å‰ç½®èŠ‚ç‚¹</span>
<span class="token number">05</span>   <span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span>
<span class="token number">06</span>   <span class="token keyword">let</span> oldVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
<span class="token number">07</span>   <span class="token keyword">let</span> newVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
<span class="token number">08</span>   <span class="token keyword">while</span> <span class="token punctuation">(</span>oldVNode<span class="token punctuation">.</span>key <span class="token operator">===</span> newVNode<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">09</span>     <span class="token function">patch</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">,</span> newVNode<span class="token punctuation">,</span> container<span class="token punctuation">)</span>
<span class="token number">10</span>     j<span class="token operator">++</span>
<span class="token number">11</span>     oldVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
<span class="token number">12</span>     newVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
<span class="token number">13</span>   <span class="token punctuation">}</span>
<span class="token number">14</span>
<span class="token number">15</span>   <span class="token comment">// æ›´æ–°ç›¸åŒçš„åç½®èŠ‚ç‚¹</span>
<span class="token number">16</span>   <span class="token comment">// ç´¢å¼• oldEnd æŒ‡å‘æ—§çš„ä¸€ç»„å­èŠ‚ç‚¹çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹</span>
<span class="token number">17</span>   <span class="token keyword">let</span> oldEnd <span class="token operator">=</span> oldChildren<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
<span class="token number">18</span>   <span class="token comment">// ç´¢å¼• newEnd æŒ‡å‘æ–°çš„ä¸€ç»„å­èŠ‚ç‚¹çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹</span>
<span class="token number">19</span>   <span class="token keyword">let</span> newEnd <span class="token operator">=</span> newChildren<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
<span class="token number">20</span>
<span class="token number">21</span>   oldVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>oldEnd<span class="token punctuation">]</span>
<span class="token number">22</span>   newVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>newEnd<span class="token punctuation">]</span>
<span class="token number">23</span>
<span class="token number">24</span>   <span class="token comment">// while å¾ªç¯ä»åå‘å‰éå†ï¼Œç›´åˆ°é‡åˆ°æ‹¥æœ‰ä¸åŒ key å€¼çš„èŠ‚ç‚¹ä¸ºæ­¢</span>
<span class="token number">25</span>   <span class="token keyword">while</span> <span class="token punctuation">(</span>oldVNode<span class="token punctuation">.</span>key <span class="token operator">===</span> newVNode<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">26</span>     <span class="token comment">// è°ƒç”¨ patch å‡½æ•°è¿›è¡Œæ›´æ–°</span>
<span class="token number">27</span>     <span class="token function">patch</span><span class="token punctuation">(</span>oldVNode<span class="token punctuation">,</span> newVNode<span class="token punctuation">,</span> container<span class="token punctuation">)</span>
<span class="token number">28</span>     <span class="token comment">// é€’å‡ oldEnd å’Œ nextEnd</span>
<span class="token number">29</span>     oldEnd<span class="token operator">--</span>
<span class="token number">30</span>     newEnd<span class="token operator">--</span>
<span class="token number">31</span>     oldVNode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>oldEnd<span class="token punctuation">]</span>
<span class="token number">32</span>     newVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>newEnd<span class="token punctuation">]</span>
<span class="token number">33</span>   <span class="token punctuation">}</span>
<span class="token number">34</span>
<span class="token number">35</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://cdn.nlark.com/yuque/0/2023/png/27119990/1681520079090-84e931d6-251a-41e1-a9b7-fdceeb48688e.png#averageHue=%23f7f7f7&amp;clientId=u26280add-9a06-4&amp;from=paste&amp;height=506&amp;id=u5f8c2ec6&amp;originHeight=455&amp;originWidth=725&amp;originalType=binary&amp;ratio=0.8999999761581421&amp;rotation=0&amp;showTitle=false&amp;size=63929&amp;status=done&amp;style=none&amp;taskId=uffa62bd0-3e2d-459d-b29e-cc7bded5352&amp;title=&amp;width=805.5555768954906" alt="image.png" loading="lazy"><br>è¿™é‡Œçš„æ–°å¢èŠ‚ç‚¹å’Œéœ€è¦ç§»é™¤çš„èŠ‚ç‚¹è·ŸåŒç«¯é‚£è¾¹ç±»ä¼¼ï¼Œåªæ˜¯ç´¢å¼•å˜é‡åå­—ç¨å¾®æœ‰ç‚¹å˜åŒ–ã€‚<br><a name="B64bB"></a></p><h6 id="_11-2-åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œdomçš„ç§»åŠ¨" tabindex="-1"><a class="header-anchor" href="#_11-2-åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œdomçš„ç§»åŠ¨" aria-hidden="true">#</a> 11.2ï¼šåˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡ŒDOMçš„ç§»åŠ¨</h6><p>ç®€æ˜çš„è¯´ï¼Œå¯¹äºä»¥ä¸Šçš„é¢„å¤„ç†ä»¥åŠç®—æ³•çš„è®¾è®¡ï¼Œæ˜¯åœ¨ç†æƒ³çŠ¶æ€ä¸‹çš„ã€‚ä¸–é—´æ€»æ˜¯ä¸é‚£ä¹ˆå°½äººæ„ã€‚æ‰€ä»¥è¿™äº›èŠ‚ç‚¹å°±æ˜¯å–œæ¬¢æ¥ç»™ä½ å‡ºé—®é¢˜ã€‚æ¯”å¦‚ä»¥ä¸‹çš„èŠ‚ç‚¹ï¼š</p><ul><li><code>newChildren</code>ï¼š2 3 1 5 6 4 7 8</li><li><code>oldChildren</code>ï¼š2 9 2 5 4 7 2 8</li></ul><p>é€šè¿‡é¢„å¤„ç†åï¼Œåªæœ‰å‰Šå»äº†å‰é¢ç¬¬ä¸€ä¸ªå’Œåé¢ç¬¬ä¸€ä¸ªï¼ŒæŒ‰ç…§ä¸Šé¢ç®—æ³•æ¥è·‘ï¼Œè¯´æ˜è¿™ä¹‹é—´çš„åˆå¾—å…¨éƒ¨å¸è½½å’Œå…¨éƒ¨æŒ‚åœ¨ï¼Œè¿™æ˜æ˜¾åˆå›åˆ°äº†åŸåœ°ï¼Œä¸ç¬¦åˆå¿«é€Ÿçš„è¿™ä¸€åç§°ã€‚<br><code>Diff</code>ç®—æ³•ï¼Œæœ¬è´¨ä¸Šæ¥è®²å°±æ˜¯æƒ³å°½å¯èƒ½åœ°å‡å°‘<code>DOM</code>æ“ä½œï¼Œå¯¹äºä¸Šé¢çš„èŠ‚ç‚¹ï¼Œæœ‰äº›è¿˜æ˜¯æ¯”è¾ƒç±»ä¼¼çš„ï¼Œè¿™è¯´æ˜ä¹Ÿè¿˜æ˜¯å¯ä»¥å¤ç”¨ï¼Œè¿™å°±å›åˆ°äº†å¦‚ä½•ç§»åŠ¨è¿™äº›å¯å¤ç”¨çš„<code>DOM</code>å…ƒç´ ä¸Šã€‚</p><blockquote><p>ä¸ç®¡å“ªç§diffç®—æ³•ï¼Œä»–ä»¬ç»ˆç©¶éƒ½éœ€è¦å»åšä¸¤ä»¶äº‹æƒ…<br> 1ã€åˆ¤æ–­æ˜¯å¦éœ€è¦ç§»åŠ¨<br> 2ã€æ‰¾åˆ°éœ€è¦æ–°å¢çš„å’Œéœ€è¦å¸è½½çš„</p></blockquote><p>æ‰€ä»¥ï¼Œå¯¹äºéç†æƒ³æƒ…å†µï¼Œåº”è¯¥å†å¼€ä¸€ä¸ªåˆ†æ”¯è¿›è¡Œå»å¤„ç†å®ƒã€‚<br>ç®—æ³•çš„è®¾è®¡æ˜¯å»ºç«‹ä¸€ä¸ª<code>source</code>æ•°ç»„ï¼Œé‡Œé¢çš„å†…å®¹æ˜¯ä¸­é—´ä¸ç†æƒ³åŒºåŸŸçš„ä¸€ä¸ªç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯å¯¹äºæ–°èŠ‚ç‚¹åœ¨æ—§èŠ‚ç‚¹ä¸Šçš„ç´¢å¼•å€¼ã€‚<br>ç„¶åé€šè¿‡è¿™ä¸ª<code>source</code>å‡½æ•°ï¼Œåˆ©ç”¨ç®€å•<code>Diff</code>ç®—æ³•çš„æ€è·¯æ‰¾å‡ºéœ€è¦ç§»åŠ¨çš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯åºåˆ—ä¿æŒé€’å¢æ—¶è¯´æ˜ä¸éœ€è¦ç§»åŠ¨ï¼Œåä¹‹åˆ™éœ€è¦ç§»åŠ¨ã€‚<br><a name="qhlYP"></a></p><h6 id="_11-3-å¦‚ä½•ç§»åŠ¨" tabindex="-1"><a class="header-anchor" href="#_11-3-å¦‚ä½•ç§»åŠ¨" aria-hidden="true">#</a> 11.3ï¼šå¦‚ä½•ç§»åŠ¨</h6><p>åŸºäºä¸Šé¢çš„æ¡ä»¶ï¼Œæˆ‘ä»¬å®ç°äº†ä¸¤ä¸ªç›®æ ‡ã€‚</p><ul><li>åˆ¤æ–­æ˜¯å¦éœ€è¦ç§»åŠ¨</li><li><code>source</code>æ•°ç»„</li></ul><p>è¿™ä¸ª<code>source</code>æ•°ç»„å¯ä¸ä¸€èˆ¬ï¼Œç²¾é«“æ‰€åœ¨ï¼Œåç»­é€šè¿‡å®ƒï¼Œè®¡ç®—å‡ºä¸€ä¸ªæœ€é•¿é€’å¢å­åºåˆ—ï¼Œç„¶åå†å»ç§»åŠ¨<code>Dom</code>ã€‚</p><blockquote><p>æœ€é•¿é€’å¢å­åºåˆ—ï¼š<a href="https://juejin.cn/post/7134499769803603999" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/7134499769803603999<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><p>æ‰¾å‡ºæœ€é•¿é€’å¢å­åºåˆ—çš„åŒºé—´ï¼Œè¯¥åŒºé—´è®°å½•çš„æ˜¯åœ¨<code>newChildren</code>ä¸­è¿™æ®µä¸Šå‡å­åºåˆ—çš„ç´¢å¼•å€¼ã€‚æ„å»ºä¸€ä¸ª<code>s</code>å’Œ<code>i</code>ã€‚</p><ul><li><code>s</code>ï¼šè¡¨ç¤ºæœ€é•¿é€’å¢å­åºåˆ—çš„å°¾éƒ¨ç´¢å¼•</li><li><code>i</code>ï¼šè¡¨ç¤º<code>newChildren</code>ä¸­é¢„å¤„ç†åçš„å°¾éƒ¨ç´¢å¼•</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2023/png/27119990/1681526855864-91ce30ff-f99c-4cb1-a5bc-cc529b8acff4.png#averageHue=%23f9f9f9&amp;clientId=u26280add-9a06-4&amp;from=paste&amp;height=417&amp;id=u0c958191&amp;originHeight=313&amp;originWidth=529&amp;originalType=binary&amp;ratio=0.8999999761581421&amp;rotation=0&amp;showTitle=false&amp;size=27997&amp;status=done&amp;style=none&amp;taskId=u5ef43c84-93c0-469e-b5e0-276d69b70ee&amp;title=&amp;width=705.3333333333334" alt="image.png" loading="lazy"><br>æ¥ç€ï¼Œå¼€å§‹éå†ã€‚ç®—æ³•çš„è®¾è®¡å¦‚ä¸‹ï¼š</p><ul><li>å¦‚æœ<code>source[i]</code>çš„å€¼ä¸º<code>-1</code>ï¼Œè¿™è¡¨æ˜è¯¥èŠ‚ç‚¹éœ€è¦æ–°å¢</li><li>å¦‚æœ<code>iï¼== seq[s]</code>ï¼Œè¡¨æ˜è¯¥èŠ‚ç‚¹éœ€è¦ç§»åŠ¨ï¼Œç›´æ¥å°†è¯¥èŠ‚ç‚¹ç§»åŠ¨åˆ°ä»–åº”è¯¥æ‰€åœ¨çš„ä½ç½®</li><li>å¦‚æœå‰ä¸¤ä¸ªåˆ†æ”¯éƒ½æ²¡èµ°ï¼Œè¯´æ˜<code>i === seq[i]</code>çš„ï¼Œè¿™æ˜¯å¯å¤ç”¨çš„èŠ‚ç‚¹ï¼Œä¸éœ€è¦åšä»»ä½•<code>Dom</code>æ“ä½œã€‚å°¾éƒ¨æå‡å°±è¡Œã€‚</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token number">01</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>moved<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">02</span>   <span class="token keyword">const</span> seq <span class="token operator">=</span> <span class="token function">lis</span><span class="token punctuation">(</span>sources<span class="token punctuation">)</span>
<span class="token number">03</span>
<span class="token number">04</span>   <span class="token comment">// s æŒ‡å‘æœ€é•¿é€’å¢å­åºåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ </span>
<span class="token number">05</span>   <span class="token keyword">let</span> s <span class="token operator">=</span> seq<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
<span class="token number">06</span>   <span class="token keyword">let</span> i <span class="token operator">=</span> count <span class="token operator">-</span> <span class="token number">1</span>
<span class="token number">07</span>   <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">08</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">09</span>       <span class="token comment">// ä¸‹é¢æ˜¯æ’å…¥ï¼Œè¿™é‡Œæ˜¯æŒ‚è½½ï¼Œä½ç½®çš„è·å–å’Œä¸‹é¢ä¸€æ ·ï¼Œåªæ˜¯éœ€è¦ç‰¹åˆ¤ä¸€ä¸‹æ˜¯å¦æ˜¯æœ€ä¸‹é¢</span>
<span class="token number">10</span>     <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">!==</span> seq<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">11</span>       <span class="token comment">// è¯´æ˜è¯¥èŠ‚ç‚¹éœ€è¦ç§»åŠ¨</span>
<span class="token number">12</span>       <span class="token comment">// è¯¥èŠ‚ç‚¹åœ¨æ–°çš„ä¸€ç»„å­èŠ‚ç‚¹ä¸­çš„çœŸå®ä½ç½®ç´¢å¼•</span>
<span class="token number">13</span>       <span class="token keyword">const</span> pos <span class="token operator">=</span> i <span class="token operator">+</span> newStart
<span class="token number">14</span>       <span class="token keyword">const</span> newVNode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>pos<span class="token punctuation">]</span>
<span class="token number">15</span>       <span class="token comment">// è¯¥èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„ä½ç½®ç´¢å¼•</span>
<span class="token number">16</span>       <span class="token keyword">const</span> nextPos <span class="token operator">=</span> pos <span class="token operator">+</span> <span class="token number">1</span>
<span class="token number">17</span>       <span class="token comment">// é”šç‚¹</span>
<span class="token number">18</span>       <span class="token keyword">const</span> anchor <span class="token operator">=</span> nextPos <span class="token operator">&lt;</span> newChildren<span class="token punctuation">.</span>length
<span class="token number">19</span>         <span class="token operator">?</span> newChildren<span class="token punctuation">[</span>nextPos<span class="token punctuation">]</span><span class="token punctuation">.</span>el
<span class="token number">20</span>         <span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token number">21</span>       <span class="token comment">// ç§»åŠ¨</span>
<span class="token number">22</span>       <span class="token function">insert</span><span class="token punctuation">(</span>newVNode<span class="token punctuation">.</span>el<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>
<span class="token number">23</span>     <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token number">24</span>       <span class="token comment">// å½“ i === seq[s] æ—¶ï¼Œè¯´æ˜è¯¥ä½ç½®çš„èŠ‚ç‚¹ä¸éœ€è¦ç§»åŠ¨</span>
<span class="token number">25</span>       <span class="token comment">// å¹¶è®© s æŒ‡å‘ä¸‹ä¸€ä¸ªä½ç½®</span>
<span class="token number">26</span>       s<span class="token operator">--</span>
<span class="token number">27</span>     <span class="token punctuation">}</span>
<span class="token number">28</span>   <span class="token punctuation">}</span>
<span class="token number">29</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a name="UDuYf"></a></p><h6 id="_11-4-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_11-4-æ€»ç»“" aria-hidden="true">#</a> 11.4ï¼šæ€»ç»“</h6><p>é¢„å¤„ç†ï¼Œå‡å°‘<code>Dom</code>æ“ä½œï¼Œå¹¶ä¸”è¿˜èƒ½ç²¾ç¡®åˆ°å½“å‰ç»„ä»¶ã€‚å› ä¸ºå¿«æ‰€ä»¥å«å¿«é€Ÿã€‚<br><a name="D5ng1"></a></p><h5 id="vueè®¾è®¡ä¸å®ç°ç¬¬åäºŒç« -ç»„ä»¶çš„å®ç°åŸç†" tabindex="-1"><a class="header-anchor" href="#vueè®¾è®¡ä¸å®ç°ç¬¬åäºŒç« -ç»„ä»¶çš„å®ç°åŸç†" aria-hidden="true">#</a> vueè®¾è®¡ä¸å®ç°ç¬¬åäºŒç« ï¼šç»„ä»¶çš„å®ç°åŸç†</h5></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: 2171077189@qq.com">é»„é™¢</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a aria-label="å†…å»ºç»„ä»¶å’Œæ¨¡å—" class="vp-link nav-link prev nav-link prev" href="/blogs/Vue%E6%BA%90%E7%A0%81/%E5%86%85%E5%BB%BA%E7%BB%84%E4%BB%B6%E5%92%8C%E6%A8%A1%E5%9D%97.html"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->å†…å»ºç»„ä»¶å’Œæ¨¡å—</div></a><a aria-label="æœåŠ¡ç«¯æ¸²æŸ“" class="vp-link nav-link next nav-link next" href="/blogs/Vue%E6%BA%90%E7%A0%81/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93.html"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">æœåŠ¡ç«¯æ¸²æŸ“<!----></div></a></nav><div id="comment" class="giscus-wrapper input-top" style="display:block;"><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">Copyright Â© 2023 Jsweet</div></footer></div><!--]--><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/blogs/assets/app-e319b9e5.js" defer></script>
  </body>
</html>
