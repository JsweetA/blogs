import{u as e,f as a,l,m as s,X as t,n as r,t as u,h as i,i as n,p as o,w as v,k as c,q as p,x as y,y as h,z as d,A as m,B as f,D as g,R as H,O as Q,s as k,j as x,E as R,F as w,G as q,H as S,I as A,J as C}from"./app-f03e95cc.js";const D=e("SEARCH_PRO_QUERY_HISTORY",[]),{resultHistoryCount:E}=A,b=e("SEARCH_PRO_RESULT_HISTORY",[]);var P=a({name:"SearchResult",props:{query:{type:String,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(e,{emit:a}){const P=l(),T=s(),_=t(r),{enabled:O,addQueryHistory:$,queryHistory:F,removeQueryHistory:I}=(()=>{const{queryHistoryCount:e}=A,a=e>0;return{enabled:a,queryHistory:D,addQueryHistory:l=>{a&&(D.value.length<e?D.value=Array.from(new Set([l,...D.value])):D.value=Array.from(new Set([l,...D.value.slice(0,e-1)])))},removeQueryHistory:e=>{D.value=[...D.value.slice(0,e),...D.value.slice(e+1)]}}})(),{enabled:U,resultHistory:L,addResultHistory:Y,removeResultHistory:j}=(()=>{const e=l(),a=E>0,s=a=>e.resolve({name:a.key,..."anchor"in a?{hash:`#${a.anchor}`}:{}}).fullPath;return{enabled:a,resultHistory:b,addResultHistory:e=>{if(a){const a={link:s(e),display:e.display};"header"in e&&(a.header=e.header),b.value.length<E?b.value=[a,...b.value]:b.value=[a,...b.value.slice(0,E-1)]}},removeResultHistory:e=>{b.value=[...b.value.slice(0,e),...b.value.slice(e+1)]}}})(),B=O||U,M=u(e,"query"),{results:z,searching:G}=(e=>{const a=H(),l=s(),{search:t,terminate:r}=Q(),u=i(!1),n=k([]);return x((()=>{const s=()=>{n.value=[],u.value=!1},i=C((e=>{u.value=!0,e?t({type:"search",query:e,locale:l.value,options:a}).then((e=>{n.value=e,u.value=!1})).catch((e=>{console.error(e),s()})):s()}),A.searchDelay);v([e,l],(()=>i(e.value)),{immediate:!0}),R((()=>{r()}))})),{searching:u,results:n}})(M),J=i({isQuery:!0,index:0}),V=i(0),X=i(0),K=n((()=>B&&(F.value.length>0||L.value.length>0))),N=n((()=>z.value.length>0)),W=n((()=>z.value[V.value]||null)),Z=e=>P.resolve({name:e.key,..."anchor"in e?{hash:`#${e.anchor}`}:{}}).fullPath,ee=()=>{X.value<W.value.contents.length-1?X.value=X.value+1:(V.value=V.value<z.value.length-1?V.value+1:0,X.value=0)},ae=()=>{X.value>0?X.value=X.value-1:(V.value=V.value>0?V.value-1:z.value.length-1,X.value=W.value.contents.length-1)},le=e=>e.map((e=>w(e)?e:c(e[0],e[1]))),se=e=>{if("customField"===e.type){const a=q[e.index]||"$content",[l,s=""]=S(a)?a[T.value].split("$content"):a.split("$content");return e.display.map((e=>c("div",le([l,...e,s]))))}return e.display.map((e=>c("div",le(e))))},te=()=>{V.value=0,X.value=0,a("updateQuery",""),a("close")};return o("keydown",(l=>{if(e.isFocusing)if(N.value){if("ArrowUp"===l.key)ae();else if("ArrowDown"===l.key)ee();else if("Enter"===l.key){const a=W.value.contents[X.value],l=Z(a);$(e.query),Y(a),P.push(l),te()}}else if(U)if("ArrowUp"===l.key)(()=>{const{isQuery:e,index:a}=J.value;J.value=0===a?{isQuery:!e,index:e?L.value.length-1:F.value.length-1}:{isQuery:e,index:a-1}})();else if("ArrowDown"===l.key)(()=>{const{isQuery:e,index:a}=J.value;a===(e?F.value.length-1:L.value.length-1)?J.value={isQuery:!e,index:0}:J.value={isQuery:e,index:a+1}})();else if("Enter"===l.key){const{index:e}=J.value;J.value.isQuery?(a("updateQuery",F.value[e]),l.preventDefault()):(P.push(L.value[e].link),te())}})),v([V,X],(()=>{var e;null==(e=document.querySelector(".search-pro-result-list-item.active .search-pro-result-item.active"))||e.scrollIntoView(!1)}),{flush:"post"}),()=>c("div",{class:["search-pro-result-wrapper",{empty:M.value?!N.value:!K.value}],id:"search-pro-results"},""===M.value?B?K.value?[O?c("ul",{class:"search-pro-result-list"},c("li",{class:"search-pro-result-list-item"},[c("div",{class:"search-pro-result-title"},_.value.history),F.value.map(((e,l)=>c("div",{class:["search-pro-result-item",{active:J.value.isQuery&&J.value.index===l}],onClick:()=>{a("updateQuery",e)}},[c(p,{class:"search-pro-result-type"}),c("div",{class:"search-pro-result-content"},e),c("button",{class:"search-pro-remove-icon",innerHTML:y,onClick:e=>{e.preventDefault(),e.stopPropagation(),I(l)}})])))])):null,U?c("ul",{class:"search-pro-result-list"},c("li",{class:"search-pro-result-list-item"},[c("div",{class:"search-pro-result-title"},_.value.history),L.value.map(((e,a)=>c(h,{to:e.link,class:["search-pro-result-item",{active:!J.value.isQuery&&J.value.index===a}],onClick:()=>{te()}},(()=>[c(p,{class:"search-pro-result-type"}),c("div",{class:"search-pro-result-content"},[e.header?c("div",{class:"content-header"},e.header):null,c("div",e.display.map((e=>le(e))).flat())]),c("button",{class:"search-pro-remove-icon",innerHTML:y,onClick:e=>{e.preventDefault(),e.stopPropagation(),j(a)}})]))))])):null]:_.value.emptyHistory:_.value.emptyResult:G.value?c(d,{hint:_.value.searching}):N.value?c("ul",{class:"search-pro-result-list"},z.value.map((({title:a,contents:l},s)=>{const t=V.value===s;return c("li",{class:["search-pro-result-list-item",{active:t}]},[c("div",{class:"search-pro-result-title"},a||_.value.defaultTitle),l.map(((a,l)=>{const s=t&&X.value===l;return c(h,{to:Z(a),class:["search-pro-result-item",{active:s,"aria-selected":s}],onClick:()=>{$(e.query),Y(a),te()}},(()=>["text"===a.type?null:c("title"===a.type?m:"heading"===a.type?f:g,{class:"search-pro-result-type"}),c("div",{class:"search-pro-result-content"},["text"===a.type&&a.header?c("div",{class:"content-header"},a.header):null,c("div",se(a))])]))}))])}))):_.value.emptyResult)}});export{P as default};
