const e={"Content-Type":"application/json"},t=e=>{const t=((e="")=>e.replace(/\/$/u,""))(e);return/^(https?:)?\/\//.test(t)?t:`https://${t}`},n=e=>{"AbortError"!==e.name&&console.error(e.message)},r=e=>e.dataset.path||e.getAttribute("id"),a=(e,t)=>{t.forEach(((t,n)=>{t.innerText=e[n].toString()}))},o=({serverURL:o,path:s=window.location.pathname,selector:l=".waline-pageview-count",update:i=!0,lang:p=navigator.language})=>{const c=new AbortController,g=Array.from(document.querySelectorAll(l)),h=e=>{const t=r(e);return null!==t&&s!==t},y=e=>(({serverURL:e,lang:t,paths:n,signal:r})=>(({serverURL:e,lang:t,paths:n,type:r,signal:a})=>fetch(`${e}/article?path=${encodeURIComponent(n.join(","))}&type=${encodeURIComponent(r.join(","))}&lang=${t}`,{signal:a}).then((e=>e.json())))({serverURL:e,lang:t,paths:n,type:["time"],signal:r}).then((e=>Array.isArray(e)?e:[e])))({serverURL:t(o),paths:e.map((e=>r(e)||s)),lang:p,signal:c.signal}).then((t=>a(t,e))).catch(n);if(i){const n=g.filter((e=>!h(e))),r=g.filter(h);(t=>(({serverURL:t,lang:n,path:r,type:a,action:o})=>fetch(`${t}/article?lang=${n}`,{method:"POST",headers:e,body:JSON.stringify({path:r,type:a,action:o})}).then((e=>e.json())))({...t,type:"time",action:"inc"}))({serverURL:t(o),path:s,lang:p}).then((e=>a(new Array(n.length).fill(e),n))),r.length&&y(r)}else y(g);return c.abort.bind(c)},s=()=>o({serverURL:COMMENT_OPTIONS.serverURL});export{s as updatePageview};
